!function(){"use strict";var e={n:function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,{a:a}),a},d:function(t,a){for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.blocks,a=window.wp.element,r=window.wp.i18n,n=window.wp.apiFetch,o=e.n(n),i=window.wp.blockEditor,l=window.wp.notices,s=window.wp.data,c=window.wp.components,m=(window.wp.hooks,window.wp.blob),u=window.wp.coreData;const d=e=>null==e||""===e,_=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},p=e=>e.replace(/<\/?a[^>]*>/g,""),g=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let a in e)e.hasOwnProperty(a)&&t.append(a,e[a]);return t},h=(e,t="")=>d(e)?t:e,q=["image"],f=(0,r.__)("Featured image"),w=(0,r.__)("Set featured image"),x=(0,a.createElement)("p",null,(0,r.__)("To edit the featured image, you need permission to upload media."));var E=({featureImageID:e,onUpdateImage:t,onRemoveImage:n})=>{const{createNotice:o}=(0,s.useDispatch)(l.store),_=(0,a.useRef)(),[p,g]=(0,a.useState)(!1),[h,E]=(0,a.useState)(void 0),{mediaFeature:b,mediaUpload:y}=(0,s.useSelect)((t=>{const{getMedia:a}=t(u.store);return{mediaFeature:d(h)&&!d(e)&&a(e),mediaUpload:t(i.store).getSettings().mediaUpload}}),[]);function I(e){y({allowedTypes:["image"],filesList:e,onFileChange([e]){(0,m.isBlobURL)(e?.url)?g(!0):(t(e),g(!1))},onError(e){o("error",e,{isDismissible:!0,type:"snackbar"})}})}return(0,a.useEffect)((()=>{let t=!0;return t&&(d(b)||"object"!=typeof b||E({id:e,width:b.media_details.width,height:b.media_details.height,url:b.source_url,alt_text:b.alt_text,slug:b.slug})),()=>{t=!1}}),[b]),(0,a.createElement)("div",{className:"editor-post-featured-image"},h&&(0,a.createElement)("div",{id:`editor-post-featured-image-${e}-describedby`,className:"hidden"},h.alt_text&&(0,r.sprintf)(
// Translators: %s: The selected image alt text.
(0,r.__)("Current image: %s"),h.alt_text),!h.alt_text&&(0,r.sprintf)(
// Translators: %s: The selected image filename.
(0,r.__)("The current image has no alternative text. The file name is: %s"),h.slug)),(0,a.createElement)(i.MediaUploadCheck,{fallback:x},(0,a.createElement)(i.MediaUpload,{title:f,onSelect:e=>{E(e),t(e)},unstableFeaturedImageFlow:!0,allowedTypes:q,modalClass:"editor-post-featured-image__media-modal",render:({open:t})=>(0,a.createElement)("div",{className:"editor-post-featured-image__container"},(0,a.createElement)(c.Button,{ref:_,className:e?"editor-post-featured-image__preview":"editor-post-featured-image__toggle",onClick:t,"aria-label":e?(0,r.__)("Edit or replace the image"):null,"aria-describedby":e?`editor-post-featured-image-${e}-describedby`:null},!!e&&h&&(0,a.createElement)(c.ResponsiveWrapper,{naturalWidth:h.width,naturalHeight:h.height,isInline:!0},(0,a.createElement)("img",{src:h.url,alt:h.alt_text})),p&&(0,a.createElement)(c.Spinner,null),!e&&!p&&w),!!e&&(0,a.createElement)(c.__experimentalHStack,{className:"editor-post-featured-image__actions"},(0,a.createElement)(c.Button,{className:"editor-post-featured-image__action",onClick:t,"aria-hidden":"true"},(0,r.__)("Replace")),(0,a.createElement)(c.Button,{className:"editor-post-featured-image__action",onClick:()=>{n(),_.current.focus()}},(0,r.__)("Remove"))),(0,a.createElement)(c.DropZone,{onFilesDrop:I})),value:e})))},b=({isCategorySelected:e,setUnsetCatgory:t})=>{const[n,i]=(0,a.useState)(!1),[l,s]=(0,a.useState)(""),[m,u]=(0,a.useState)(0),[_,p]=(0,a.useState)(!1),[h,q]=(0,a.useState)(!1),[f,w]=(0,a.useState)(qsmBlockData?.hierarchicalCategoryList),x=(0,r.__)("Add New Category ","quiz-master-next"),E=`— ${(0,r.__)("Parent Category ","quiz-master-next")} —`,b=(e,t)=>{let a=!1;t.forEach((t=>{if(t.name==e)return a=!0,!1;0<t.children.length&&b(e,t.children)})),q(a),s(e)},y=r=>r.map((r=>(0,a.createElement)("div",{key:r.id,className:"editor-post-taxonomies__hierarchical-terms-choice"},(0,a.createElement)(c.CheckboxControl,{label:r.name,checked:e(r.id),onChange:()=>t(r.id)}),!!r.children.length&&(0,a.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},y(r.children)))));return(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Categories","quiz-master-next"),initialOpen:!0},(0,a.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-list",tabIndex:"0",role:"group","aria-label":(0,r.__)("Categories","quiz-master-next")},y(f)),(0,a.createElement)("div",{className:"qsm-ptb-1"},(0,a.createElement)(c.Button,{variant:"link",onClick:()=>i(!n)},x)),n&&(0,a.createElement)("form",{onSubmit:async e=>{e.preventDefault(),h||d(l)||_||(p(!0),o()({url:qsmBlockData.ajax_url,method:"POST",body:g({action:"save_new_category",name:l,parent:m})}).then((e=>{if(!d(e.term_id)){let a=e.term_id;o()({path:"/quiz-survey-master/v1/quiz/hierarchical-category-list",method:"POST"}).then((e=>{"success"==e.status&&(w(e.result),s(""),u(0),t(a),p(!1))}))}})))}},(0,a.createElement)(c.Flex,{direction:"column",gap:"1"},(0,a.createElement)(c.TextControl,{__nextHasNoMarginBottom:!0,className:"editor-post-taxonomies__hierarchical-terms-input",label:(0,r.__)("Category Name","quiz-master-next"),value:l,onChange:e=>b(e,f),required:!0}),0<f.length&&(0,a.createElement)(c.TreeSelect,{__nextHasNoMarginBottom:!0,label:(0,r.__)("Parent Category","quiz-master-next"),noOptionLabel:E,onChange:e=>u(e),selectedId:m,tree:f}),(0,a.createElement)(c.FlexItem,null,(0,a.createElement)(c.Button,{variant:"secondary",type:"submit",className:"editor-post-taxonomies__hierarchical-terms-submit",disabled:h||_},x)),(0,a.createElement)(c.FlexItem,null,(0,a.createElement)("p",{className:"qsm-error-text"},h&&(0,r.__)("Category ","quiz-master-next")+l+(0,r.__)(" already exists.","quiz-master-next"))))))},y=JSON.parse('{"u2":"qsm/quiz-question"}');(0,t.registerBlockType)(y.u2,{edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:m,isSelected:u,clientId:q,context:f}=e,w=(0,s.useSelect)((e=>u||e("core/block-editor").hasSelectedInnerBlock(q,!0))),x=f["quiz-master-next/quizID"],{quiz_name:y,post_id:I,rest_nonce:k}=f["quiz-master-next/quizAttr"],{createNotice:v}=(f["quiz-master-next/pageID"],(0,s.useDispatch)(l.store)),{questionID:C,type:B,description:D,title:z,correctAnswerInfo:N,commentBox:S,category:T,multicategories:F,hint:P,featureImageID:O,featureImageSrc:R,answers:A,answerEditor:U,matchAnswer:H,required:M,settings:L}=n,[Q,j]=(0,a.useState)(L);(0,a.useEffect)((()=>{let e=!0;if(e&&(d(C)||"0"==C||!d(C)&&((e,t)=>{const a=(0,s.select)("core/block-editor").getClientIdsWithDescendants();return!d(a)&&a.some((a=>{const{questionID:r}=(0,s.select)("core/block-editor").getBlockAttributes(a);return t!==a&&r===e}))})(C,q))){let e=g({id:null,rest_nonce:k,quizID:x,quiz_name:y,postID:I,answerEditor:h(U,"text"),type:h(B,"0"),name:_(h(D)),question_title:h(z),answerInfo:_(h(N)),comments:h(S,"1"),hint:h(P),category:h(T),multicategories:[],required:h(M,1),answers:A,page:0,featureImageID:O,featureImageSrc:R,matchAnswer:null});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:e}).then((e=>{if(console.log("question created",e),"success"==e.status){let t=e.id;m({questionID:t})}})).catch((e=>{console.log("error",e),v("error",e.message,{isDismissible:!0,type:"snackbar"})}))}return()=>{e=!1}}),[]);const W=(0,i.useBlockProps)({className:w?" in-editing-mode":""});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(i.InspectorControls,null,(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Question settings","quiz-master-next"),initialOpen:!0},(0,a.createElement)("h2",{className:"block-editor-block-card__title"},(0,r.__)("ID","quiz-master-next")+": "+C),(0,a.createElement)(c.SelectControl,{label:qsmBlockData.question_type.label,value:B||qsmBlockData.question_type.default,onChange:e=>m({type:e}),__nextHasNoMarginBottom:!0},!d(qsmBlockData.question_type.options)&&qsmBlockData.question_type.options.map((e=>(0,a.createElement)("optgroup",{label:e.category,key:"qtypes"+e.category},e.types.map((e=>(0,a.createElement)("option",{value:e.slug,key:"qtype"+e.slug},e.name))))))),(0,a.createElement)(c.SelectControl,{label:qsmBlockData.answerEditor.label,value:U||qsmBlockData.answerEditor.default,options:qsmBlockData.answerEditor.options,onChange:e=>m({answerEditor:e}),__nextHasNoMarginBottom:!0}),(0,a.createElement)(c.ToggleControl,{label:(0,r.__)("Required","quiz-master-next"),checked:!d(M)&&"1"==M,onChange:()=>m({required:d(M)||"1"!=M?1:0})})),(0,a.createElement)(b,{isCategorySelected:e=>T==e||F.includes(e),setUnsetCatgory:e=>{if(d(T)&&(d(F)||0===F.length))m({category:e});else if(e==T)m({category:""});else{let t=d(F)||0===F.length?[]:F;t.includes(e)?t=t.filter((t=>t!=e)):t.push(e),m({category:"",multicategories:[...t]})}}}),(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Featured image","quiz-master-next"),initialOpen:!0},(0,a.createElement)(E,{featureImageID:O,onUpdateImage:e=>{m({featureImageID:e.id,featureImageSrc:e.url})},onRemoveImage:e=>{m({featureImageID:void 0,featureImageSrc:void 0})}})),(0,a.createElement)(c.PanelBody,{title:qsmBlockData.commentBox.heading},(0,a.createElement)(c.SelectControl,{label:qsmBlockData.commentBox.label,value:S||qsmBlockData.commentBox.default,options:qsmBlockData.commentBox.options,onChange:e=>m({commentBox:e}),__nextHasNoMarginBottom:!0}))),(0,a.createElement)("div",{...W},(0,a.createElement)(i.RichText,{tagName:"h4",title:(0,r.__)("Question title","quiz-master-next"),"aria-label":(0,r.__)("Question title","quiz-master-next"),placeholder:(0,r.__)("Type your question here","quiz-master-next"),value:z,onChange:e=>m({title:p(e)}),allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-title"}),w&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(i.RichText,{tagName:"p",title:(0,r.__)("Question description","quiz-master-next"),"aria-label":(0,r.__)("Question description","quiz-master-next"),placeholder:(0,r.__)("Description goes here","quiz-master-next"),value:_(D),onChange:e=>m({description:e}),className:"qsm-question-description",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),(0,a.createElement)(i.InnerBlocks,{allowedBlocks:["qsm/quiz-answer-option"],template:[["qsm/quiz-answer-option",{optionID:"0"}],["qsm/quiz-answer-option",{optionID:"1"}]]}),(0,a.createElement)(i.RichText,{tagName:"p",title:(0,r.__)("Correct Answer Info","quiz-master-next"),"aria-label":(0,r.__)("Correct Answer Info","quiz-master-next"),placeholder:(0,r.__)("Correct answer info goes here","quiz-master-next"),value:_(N),onChange:e=>m({correctAnswerInfo:e}),className:"qsm-question-correct-answer-info",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),(0,a.createElement)(i.RichText,{tagName:"p",title:(0,r.__)("Hint","quiz-master-next"),"aria-label":(0,r.__)("Hint","quiz-master-next"),placeholder:(0,r.__)("hint goes here","quiz-master-next"),value:P,onChange:e=>m({hint:p(e)}),allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-hint"}))))}})}();