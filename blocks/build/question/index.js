!function(){"use strict";var e={n:function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,{a:a}),a},d:function(t,a){for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.blocks,a=window.wp.element,r=window.wp.i18n,n=window.wp.apiFetch,i=e.n(n),o=window.wp.blockEditor,l=window.wp.notices,s=window.wp.data,c=window.wp.components,m=(window.wp.hooks,window.wp.blob),u=window.wp.coreData;const d=e=>null==e||""===e,p=e=>d(e)||!Array.isArray(e)?e:e.filter(((e,t,a)=>a.indexOf(e)===t)),_=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},g=e=>{let t=document.createElement("div");return t.innerHTML=_(e),t.innerText},h=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let a in e)e.hasOwnProperty(a)&&t.append(a,e[a]);return t},q=(e,t="")=>d(e)?t:e,f=["image"],w=(0,r.__)("Featured image"),x=(0,r.__)("Set featured image"),E=(0,a.createElement)("p",null,(0,r.__)("To edit the featured image, you need permission to upload media."));var y=({featureImageID:e,onUpdateImage:t,onRemoveImage:n})=>{const{createNotice:i}=(0,s.useDispatch)(l.store),p=(0,a.useRef)(),[_,g]=(0,a.useState)(!1),[h,q]=(0,a.useState)(void 0),{mediaFeature:y,mediaUpload:b}=(0,s.useSelect)((t=>{const{getMedia:a}=t(u.store);return{mediaFeature:d(h)&&!d(e)&&a(e),mediaUpload:t(o.store).getSettings().mediaUpload}}),[]);function k(e){b({allowedTypes:["image"],filesList:e,onFileChange([e]){(0,m.isBlobURL)(e?.url)?g(!0):(t(e),g(!1))},onError(e){i("error",e,{isDismissible:!0,type:"snackbar"})}})}return(0,a.useEffect)((()=>{let t=!0;return t&&(d(y)||"object"!=typeof y||q({id:e,width:y.media_details.width,height:y.media_details.height,url:y.source_url,alt_text:y.alt_text,slug:y.slug})),()=>{t=!1}}),[y]),(0,a.createElement)("div",{className:"editor-post-featured-image"},h&&(0,a.createElement)("div",{id:`editor-post-featured-image-${e}-describedby`,className:"hidden"},h.alt_text&&(0,r.sprintf)(
// Translators: %s: The selected image alt text.
(0,r.__)("Current image: %s"),h.alt_text),!h.alt_text&&(0,r.sprintf)(
// Translators: %s: The selected image filename.
(0,r.__)("The current image has no alternative text. The file name is: %s"),h.slug)),(0,a.createElement)(o.MediaUploadCheck,{fallback:E},(0,a.createElement)(o.MediaUpload,{title:w,onSelect:e=>{q(e),t(e)},unstableFeaturedImageFlow:!0,allowedTypes:f,modalClass:"editor-post-featured-image__media-modal",render:({open:t})=>(0,a.createElement)("div",{className:"editor-post-featured-image__container"},(0,a.createElement)(c.Button,{ref:p,className:e?"editor-post-featured-image__preview":"editor-post-featured-image__toggle",onClick:t,"aria-label":e?(0,r.__)("Edit or replace the image"):null,"aria-describedby":e?`editor-post-featured-image-${e}-describedby`:null},!!e&&h&&(0,a.createElement)(c.ResponsiveWrapper,{naturalWidth:h.width,naturalHeight:h.height,isInline:!0},(0,a.createElement)("img",{src:h.url,alt:h.alt_text})),_&&(0,a.createElement)(c.Spinner,null),!e&&!_&&x),!!e&&(0,a.createElement)(c.__experimentalHStack,{className:"editor-post-featured-image__actions"},(0,a.createElement)(c.Button,{className:"editor-post-featured-image__action",onClick:t,"aria-hidden":"true"},(0,r.__)("Replace")),(0,a.createElement)(c.Button,{className:"editor-post-featured-image__action",onClick:()=>{n(),p.current.focus()}},(0,r.__)("Remove"))),(0,a.createElement)(c.DropZone,{onFilesDrop:k})),value:e})))},b=({isCategorySelected:e,setUnsetCatgory:t})=>{const[n,o]=(0,a.useState)(!1),[l,s]=(0,a.useState)(""),[m,u]=(0,a.useState)(0),[p,_]=(0,a.useState)(!1),[g,q]=(0,a.useState)(!1),[f,w]=(0,a.useState)(qsmBlockData?.hierarchicalCategoryList),x=e=>{let t={};return e.forEach((e=>{if(t[e.id]=e,0<e.children.length){let a=x(e.children);t={...t,...a}}})),t},[E,y]=(0,a.useState)(d(qsmBlockData?.hierarchicalCategoryList)?{}:x(qsmBlockData.hierarchicalCategoryList)),b=(0,r.__)("Add New Category ","quiz-master-next"),k=`— ${(0,r.__)("Parent Category ","quiz-master-next")} —`,I=e=>{let t=[];return e.forEach((e=>{if(t.push(e.name),0<e.children.length){let a=I(e.children);t=[...t,...a]}})),t},C=r=>r.map((r=>(0,a.createElement)("div",{key:r.id,className:"editor-post-taxonomies__hierarchical-terms-choice"},(0,a.createElement)(c.CheckboxControl,{label:r.name,checked:e(r.id),onChange:()=>t(r.id,E)}),!!r.children.length&&(0,a.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},C(r.children)))));return(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Categories","quiz-master-next"),initialOpen:!0},(0,a.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-list",tabIndex:"0",role:"group","aria-label":(0,r.__)("Categories","quiz-master-next")},C(f)),(0,a.createElement)("div",{className:"qsm-ptb-1"},(0,a.createElement)(c.Button,{variant:"link",onClick:()=>o(!n)},b)),n&&(0,a.createElement)("form",{onSubmit:async e=>{e.preventDefault(),g||d(l)||p||(_(!0),i()({url:qsmBlockData.ajax_url,method:"POST",body:h({action:"save_new_category",name:l,parent:m})}).then((e=>{if(!d(e.term_id)){let a=e.term_id;i()({path:"/quiz-survey-master/v1/quiz/hierarchical-category-list",method:"POST"}).then((e=>{"success"==e.status&&(w(e.result),y(e.result),s(""),u(0),t(a,x(term.id)),_(!1))}))}})))}},(0,a.createElement)(c.Flex,{direction:"column",gap:"1"},(0,a.createElement)(c.TextControl,{__nextHasNoMarginBottom:!0,className:"editor-post-taxonomies__hierarchical-terms-input",label:(0,r.__)("Category Name","quiz-master-next"),value:l,onChange:e=>((e,t)=>{t=I(t),console.log("categories",t),t.includes(e)?q(e):(q(!1),s(e))})(e,f),required:!0}),0<f.length&&(0,a.createElement)(c.TreeSelect,{__nextHasNoMarginBottom:!0,label:(0,r.__)("Parent Category","quiz-master-next"),noOptionLabel:k,onChange:e=>u(e),selectedId:m,tree:f}),(0,a.createElement)(c.FlexItem,null,(0,a.createElement)(c.Button,{variant:"secondary",type:"submit",className:"editor-post-taxonomies__hierarchical-terms-submit",disabled:g||p},b)),(0,a.createElement)(c.FlexItem,null,(0,a.createElement)("p",{className:"qsm-error-text"},!1!==g&&(0,r.__)("Category ","quiz-master-next")+g+(0,r.__)(" already exists.","quiz-master-next"))))))},k=JSON.parse('{"u2":"qsm/quiz-question"}');(0,t.registerBlockType)(k.u2,{edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:m,isSelected:u,clientId:f,context:w}=e,x=(0,s.useSelect)((e=>u||e("core/block-editor").hasSelectedInnerBlock(f,!0))),E=w["quiz-master-next/quizID"],{quiz_name:k,post_id:I,rest_nonce:C}=w["quiz-master-next/quizAttr"],{createNotice:v}=(w["quiz-master-next/pageID"],(0,s.useDispatch)(l.store)),{isChanged:B=!1,questionID:D,type:z,description:N,title:S,correctAnswerInfo:T,commentBox:F,category:P,multicategories:A,hint:O,featureImageID:R,featureImageSrc:U,answers:H,answerEditor:M,matchAnswer:L,required:Q}=n;(0,a.useEffect)((()=>{let e=!0;if(e&&(d(D)||"0"==D||!d(D)&&((e,t)=>{const a=(0,s.select)("core/block-editor").getClientIdsWithDescendants();return!d(a)&&a.some((a=>{const{questionID:r}=(0,s.select)("core/block-editor").getBlockAttributes(a);return t!==a&&r===e}))})(D,f))){let e=h({id:null,rest_nonce:C,quizID:E,quiz_name:k,postID:I,answerEditor:q(M,"text"),type:q(z,"0"),name:_(q(N)),question_title:q(S),answerInfo:_(q(T)),comments:q(F,"1"),hint:q(O),category:q(P),multicategories:[],required:q(Q,1),answers:H,page:0,featureImageID:R,featureImageSrc:U,matchAnswer:null});i()({path:"/quiz-survey-master/v1/questions",method:"POST",body:e}).then((e=>{if(console.log("question created",e),"success"==e.status){let t=e.id;m({questionID:t})}})).catch((e=>{console.log("error",e),v("error",e.message,{isDismissible:!0,type:"snackbar"})}))}return()=>{e=!1}}),[]),(0,a.useEffect)((()=>{let e=!0;return e&&u&&!1===B&&m({isChanged:!0}),()=>{e=!1}}),[D,z,N,S,T,F,P,A,O,R,U,H,M,L,Q]);const j=(0,o.useBlockProps)({className:x?" in-editing-mode":""}),W=(e,t)=>{let a=[];if(!d(t[e])&&"0"!=t[e].parent&&(e=t[e].parent,a.push(e),!d(t[e])&&"0"!=t[e].parent)){let r=W(e,t);a=[...a,...r]}return p(a)},$=["12","7","3","5","14"].includes(z)?(0,r.__)("Note: Add only correct answer options with their respective points score.","quiz-master-next"):"";return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(o.InspectorControls,null,(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Question settings","quiz-master-next"),initialOpen:!0},(0,a.createElement)("h2",{className:"block-editor-block-card__title"},(0,r.__)("ID","quiz-master-next")+": "+D),(0,a.createElement)(c.SelectControl,{label:qsmBlockData.question_type.label,value:z||qsmBlockData.question_type.default,onChange:e=>m({type:e}),help:d(qsmBlockData.question_type_description[z])?"":qsmBlockData.question_type_description[z]+" "+$,__nextHasNoMarginBottom:!0},!d(qsmBlockData.question_type.options)&&qsmBlockData.question_type.options.map((e=>(0,a.createElement)("optgroup",{label:e.category,key:"qtypes"+e.category},e.types.map((e=>(0,a.createElement)("option",{value:e.slug,key:"qtype"+e.slug},e.name))))))),["0","4","1","10","13"].includes(z)&&(0,a.createElement)(c.SelectControl,{label:qsmBlockData.answerEditor.label,value:M||qsmBlockData.answerEditor.default,options:qsmBlockData.answerEditor.options,onChange:e=>m({answerEditor:e}),__nextHasNoMarginBottom:!0}),(0,a.createElement)(c.ToggleControl,{label:(0,r.__)("Required","quiz-master-next"),checked:!d(Q)&&"1"==Q,onChange:()=>m({required:d(Q)||"1"!=Q?1:0})})),(0,a.createElement)(b,{isCategorySelected:e=>A.includes(e),setUnsetCatgory:(e,t)=>{let a=d(A)||0===A.length?d(P)?[]:[P]:A;if(a.includes(e))a=a.filter((t=>t!=e)),a.forEach((r=>{W(r,t).includes(e)&&(a=a.filter((e=>e!=r)))}));else{a.push(e);let r=W(e,t);a=[...a,...r]}a=p(a),m({category:"",multicategories:[...a]})}}),(0,a.createElement)(c.PanelBody,{title:(0,r.__)("Featured image","quiz-master-next"),initialOpen:!0},(0,a.createElement)(y,{featureImageID:R,onUpdateImage:e=>{m({featureImageID:e.id,featureImageSrc:e.url})},onRemoveImage:e=>{m({featureImageID:void 0,featureImageSrc:void 0})}})),(0,a.createElement)(c.PanelBody,{title:qsmBlockData.commentBox.heading},(0,a.createElement)(c.SelectControl,{label:qsmBlockData.commentBox.label,value:F||qsmBlockData.commentBox.default,options:qsmBlockData.commentBox.options,onChange:e=>m({commentBox:e}),__nextHasNoMarginBottom:!0}))),(0,a.createElement)("div",{...j},(0,a.createElement)(o.RichText,{tagName:"h4",title:(0,r.__)("Question title","quiz-master-next"),"aria-label":(0,r.__)("Question title","quiz-master-next"),placeholder:(0,r.__)("Type your question here","quiz-master-next"),value:S,onChange:e=>m({title:g(e)}),allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-title"}),x&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(o.RichText,{tagName:"p",title:(0,r.__)("Question description","quiz-master-next"),"aria-label":(0,r.__)("Question description","quiz-master-next"),placeholder:(0,r.__)("Description goes here","quiz-master-next"),value:_(N),onChange:e=>m({description:e}),className:"qsm-question-description",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),!["8","11","6","9"].includes(z)&&(0,a.createElement)(o.InnerBlocks,{allowedBlocks:["qsm/quiz-answer-option"],template:[["qsm/quiz-answer-option",{optionID:"0"}],["qsm/quiz-answer-option",{optionID:"1"}]]}),(0,a.createElement)(o.RichText,{tagName:"p",title:(0,r.__)("Correct Answer Info","quiz-master-next"),"aria-label":(0,r.__)("Correct Answer Info","quiz-master-next"),placeholder:(0,r.__)("Correct answer info goes here","quiz-master-next"),value:_(T),onChange:e=>m({correctAnswerInfo:e}),className:"qsm-question-correct-answer-info",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),(0,a.createElement)(o.RichText,{tagName:"p",title:(0,r.__)("Hint","quiz-master-next"),"aria-label":(0,r.__)("Hint","quiz-master-next"),placeholder:(0,r.__)("hint goes here","quiz-master-next"),value:O,onChange:e=>m({hint:g(e)}),allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-hint"}))))}})}();