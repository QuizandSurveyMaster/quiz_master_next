!function(){"use strict";var e,t={820:function(e,t,n){var a=window.wp.blocks,s=window.wp.element,i=window.wp.i18n,r=window.wp.apiFetch,o=n.n(r),l=window.wp.htmlEntities,u=window.wp.blockEditor,c=window.wp.notices,m=window.wp.data,p=window.wp.editor,q=window.wp.components;const d=e=>null==e||""===e,g=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},_=e=>{let t=document.createElement("div");return t.innerHTML=g(e),t.innerText},h=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},f=e=>{let t="";const n=new Uint8Array(e);window.crypto.getRandomValues(n);for(let a=0;a<e;a++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[n[a]%62];return t},z=(e="",t=!1)=>`${e}${f(8)}${t?`.${f(7)}`:""}`,b=(e,t="")=>d(e)?t:e,v=()=>{};function w({className:e="",quizAttr:t,setAttributes:n,data:a,onChangeFunc:i=v}){const r=(()=>{if(a.defaultvalue=a.default,!d(a?.options))switch(a.type){case"checkbox":1===a.options.length&&(a.type="toggle"),a.label=a.options[0].label;break;case"radio":1<a.options.length?a.type="select":a.label=a.options[0].label}return a.label=d(a.label)?"":_(a.label),a.help=d(a.help)?"":_(a.help),a})(),{id:o,label:l="",type:u,help:c="",options:m=[],defaultvalue:p}=r;return(()=>{var e,n,a,r;switch(u){case"toggle":return(0,s.createElement)(q.ToggleControl,{label:l,help:c,checked:!d(t[o])&&"1"==t[o],onChange:()=>i(d(t[o])||"1"!=t[o]?1:0,o)});case"select":return(0,s.createElement)(q.SelectControl,{label:l,value:null!==(e=t[o])&&void 0!==e?e:p,options:m,onChange:e=>i(e,o),help:c,__nextHasNoMarginBottom:!0});case"number":return(0,s.createElement)(q.TextControl,{type:"number",label:l,value:null!==(n=t[o])&&void 0!==n?n:p,onChange:e=>i(e,o),help:c,__nextHasNoMarginBottom:!0});case"text":return(0,s.createElement)(q.TextControl,{type:"text",label:l,value:null!==(a=t[o])&&void 0!==a?a:p,onChange:e=>i(e,o),help:c,__nextHasNoMarginBottom:!0});case"checkbox":return(0,s.createElement)(q.CheckboxControl,{label:l,help:c,checked:!d(t[o])&&"1"==t[o],onChange:()=>i(d(t[o])||"1"!=t[o]?1:0,o)});default:return(0,s.createElement)(q.TextControl,{type:"text",label:l,value:null!==(r=t[o])&&void 0!==r?r:p,onChange:e=>i(e,o),help:c,__nextHasNoMarginBottom:!0})}})()}const y=()=>(0,s.createElement)(q.Icon,{icon:()=>(0,s.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,s.createElement)("rect",{width:"24",height:"24",rx:"3",fill:"black"}),(0,s.createElement)("path",{d:"M17.8146 17.8349C19.3188 16.3426 20.25 14.2793 20.25 12C20.2485 7.44425 16.5267 3.75 11.9348 3.75C7.34282 3.75 3.62109 7.44425 3.62109 12C3.62109 16.5558 7.34282 20.25 11.9348 20.25H18.9988C19.4682 20.25 19.7074 19.7112 19.3813 19.3885L17.8146 17.8334V17.8349ZM11.8753 17.5195C8.72666 17.5195 6.17388 15.0737 6.17388 12.0569C6.17388 9.04022 8.72666 6.59442 11.8753 6.59442C15.024 6.59442 17.5768 9.04022 17.5768 12.0569C17.5768 15.0737 15.024 17.5195 11.8753 17.5195Z",fill:"white"}))});(0,a.registerBlockType)("qsm/quiz",{icon:y,edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:a,isSelected:r,clientId:_}=e,{createNotice:f}=(0,m.useDispatch)(c.store),v=qsmBlockData.globalQuizsetting,{quizID:E,postID:k,quizAttr:x=v}=n,[D,I]=(0,s.useState)(qsmBlockData.QSMQuizList),[B,C]=(0,s.useState)({error:!1,msg:""}),[S,N]=(0,s.useState)(!1),[O,A]=(0,s.useState)(!1),[P,T]=(0,s.useState)(!1),[M,Q]=(0,s.useState)([]),H=qsmBlockData.quizOptions,j=(0,m.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(p.store);return n()&&!t()}),[]),{getBlock:F}=(0,m.useSelect)(u.store);(0,s.useEffect)((()=>{let e=!0;if(e&&("0"==qsmBlockData.is_pro_activated&&setTimeout((()=>{L()}),100),!d(E)&&0<E)){let e=!1;D.forEach((t=>{if(E==t.value)return e=!0,!0})),e?K(E):(a({quizID:void 0}),C({error:!0,msg:(0,i.__)("Quiz not found. Please select an existing quiz or create a new one.","quiz-master-next")}))}return()=>{e=!1}}),[]);const L=()=>{let e=document.getElementById("modal-advanced-question-type");d(e)&&o()({path:"/quiz-survey-master/v1/quiz/advance-ques-type-upgrade-popup",method:"POST"}).then((e=>{let t=document.getElementById("wpbody-content");d(t)||"success"!=e.status||t.insertAdjacentHTML("afterbegin",e.result)})).catch((e=>{console.log("error",e)}))},K=e=>{!d(e)&&0<e&&o()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:e}}).then((t=>{if("success"==t.status){C({error:!1,msg:""});let n=t.result;if(a({quizID:parseInt(e),postID:n.post_id,quizAttr:{...x,...n}}),!d(n.qpages)){let e=[];n.qpages.forEach((t=>{let n=[];d(t.question_arr)||t.question_arr.forEach((e=>{if(!d(e)){let t=[];!d(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2],caption:b(e[3])}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:e.settings.required,hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),Q(e)}}else console.log("error "+t.msg)})).catch((e=>{console.log("error",e)}))},V=(e,t)=>{let n=x;n[t]=e,a({quizAttr:{...n}})};(0,s.useEffect)((()=>{if(j){let e=(()=>{let e=F(_);if(d(e))return!1;e=e.innerBlocks;let t={quiz_id:x.quiz_id,post_id:x.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let a=e.attributes.pageID,s=[];!d(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let a=e.attributes,i=b(a?.answerEditor,"text"),r=[];!d(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes,n=b(t?.content);d(a?.answerEditor)||"rich"!==a.answerEditor||(n=g((0,l.decodeEntities)(n)));let s=[n,b(t?.points),b(t?.isCorrect)];"image"!==i||d(t?.caption)||s.push(t?.caption),r.push(s)})),s.push(a.questionID),a.isChanged&&t.questions.push({id:a.questionID,quizID:x.quiz_id,postID:x.post_id,answerEditor:i,type:b(a?.type,"0"),name:g(b(a?.description)),question_title:b(a?.title),answerInfo:g(b(a?.correctAnswerInfo)),comments:b(a?.commentBox,"1"),hint:b(a?.hint),category:b(a?.category),multicategories:b(a?.multicategories,[]),required:b(a?.required,0),answers:r,featureImageID:b(a?.featureImageID),featureImageSrc:b(a?.featureImageSrc),page:n,other_settings:{...b(a?.settings,{}),required:b(a?.required,0)}})})),t.pages.push(s),t.qpages.push({id:a,quizID:x.quiz_id,pagekey:d(e.attributes.pageKey)?z():e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:s}),n++}})),t.quiz={quiz_name:x.quiz_name,quiz_id:x.quiz_id,post_id:x.post_id},P&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==x[e]&&null!==x[e]&&(t.quiz[e]=x[e])})),t})();A(!0),e=h({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,nonce:qsmBlockData.saveNonce}),o()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{f(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),f("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[j]);const $=(0,u.useBlockProps)(),R=(0,u.useInnerBlocksProps)($,{template:M,allowedBlocks:["qsm/quiz-page"]});return(0,s.createElement)(s.Fragment,null,(0,s.createElement)(u.InspectorControls,null,(0,s.createElement)(q.PanelBody,{title:(0,i.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,s.createElement)("label",{className:"qsm-inspector-label"},(0,i.__)("Status","quiz-master-next")+":",(0,s.createElement)("span",{className:"qsm-inspector-label-value"},x.post_status)),(0,s.createElement)(q.TextControl,{label:(0,i.__)("Quiz Name *","quiz-master-next"),help:(0,i.__)("Enter a name for this Quiz","quiz-master-next"),value:x?.quiz_name||"",onChange:e=>V(e,"quiz_name"),className:"qsm-no-mb"}),(!d(E)||"0"!=E)&&(0,s.createElement)("p",null,(0,s.createElement)(q.ExternalLink,{href:qsmBlockData.quiz_settings_url+"&quiz_id="+E},(0,i.__)("Advance Quiz Settings","quiz-master-next"))))),d(E)||"0"==E?(0,s.createElement)(q.Placeholder,{className:"qsm-placeholder-wrapper",icon:y,label:(0,i.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,i.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,s.createElement)(s.Fragment,null,!d(D)&&0<D.length&&(0,s.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,s.createElement)(q.SelectControl,{label:(0,i.__)("","quiz-master-next"),value:E,options:D,onChange:e=>K(e),disabled:S,__nextHasNoMarginBottom:!0}),(0,s.createElement)("span",null,(0,i.__)("OR","quiz-master-next")),(0,s.createElement)(q.Button,{variant:"link",onClick:()=>N(!S)},(0,i.__)("Add New","quiz-master-next"))),(d(D)||S)&&(0,s.createElement)(q.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,s.createElement)(q.TextControl,{label:(0,i.__)("Quiz Name *","quiz-master-next"),help:(0,i.__)("Enter a name for this Quiz","quiz-master-next"),value:x?.quiz_name||"",onChange:e=>V(e,"quiz_name")}),(0,s.createElement)(q.Button,{variant:"link",onClick:()=>T(!P)},(0,i.__)("Advance options","quiz-master-next")),(0,s.createElement)("div",{className:"qsm-advance-settings"},P&&H.map((e=>(0,s.createElement)(w,{key:"qsm-settings"+e.id,data:e,quizAttr:x,setAttributes:a,onChangeFunc:V})))),(0,s.createElement)(q.Button,{variant:"primary",disabled:O||d(x.quiz_name),onClick:()=>(()=>{if(d(x.quiz_name))return void console.log("empty quiz_name");A(!0);let e=h({quiz_name:x.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===x[t]||null===x[t]?"":e.append(t,x[t]))),o()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(A(!1),"success"==e.status){let t=h({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:0,answers:[],page:0});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if("success"==t.status){let n=t.id,a=h({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});a.append("pages[0][]",n),a.append("qpages[0][id]",1),a.append("qpages[0][quizID]",e.quizID),a.append("qpages[0][pagekey]",z()),a.append("qpages[0][hide_prevbtn]",0),a.append("qpages[0][questions][]",n),o()({url:qsmBlockData.ajax_url,method:"POST",body:a}).then((t=>{"success"==t.status&&K(e.quizID)}))}})).catch((e=>{console.log("error",e),f("error",e.message,{isDismissible:!0,type:"snackbar"})}))}f(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),f("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,i.__)("Create Quiz","quiz-master-next"))),B.error&&(0,s.createElement)("p",{className:"qsm-error-text"},B.msg))):(0,s.createElement)("div",{...R}))},save:e=>null})}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,a),i.exports}a.m=t,e=[],a.O=function(t,n,s,i){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],s=e[c][1],i=e[c][2];for(var o=!0,l=0;l<n.length;l++)(!1&i||r>=i)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(o=!1,i<r&&(r=i));if(o){e.splice(c--,1);var u=s();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,s,i]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,i,r=n[0],o=n[1],l=n[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);if(l)var c=l(a)}for(t&&t(n);u<r.length;u++)i=r[u],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},n=self.webpackChunkqsm=self.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var s=a.O(void 0,[431],(function(){return a(820)}));s=a.O(s)}();