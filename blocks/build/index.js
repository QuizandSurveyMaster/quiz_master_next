!function(){"use strict";var e,t={775:function(e,t,n){var a=window.wp.blocks,i=window.wp.element,s=window.wp.i18n,r=window.wp.apiFetch,o=n.n(r),l=window.wp.htmlEntities,u=window.wp.blockEditor,c=window.wp.notices,m=window.wp.data,p=window.wp.editor,q=window.wp.components;const _=e=>null==e||""===e,d=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},g=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},h=(e,t="")=>_(e)?t:e,f=()=>(0,i.createElement)(q.Icon,{icon:()=>(0,i.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,i.createElement)("rect",{width:"24",height:"24",rx:"3",fill:"black"}),(0,i.createElement)("path",{d:"M17.8146 17.8349C19.3188 16.3426 20.25 14.2793 20.25 12C20.2485 7.44425 16.5267 3.75 11.9348 3.75C7.34282 3.75 3.62109 7.44425 3.62109 12C3.62109 16.5558 7.34282 20.25 11.9348 20.25H18.9988C19.4682 20.25 19.7074 19.7112 19.3813 19.3885L17.8146 17.8334V17.8349ZM11.8753 17.5195C8.72666 17.5195 6.17388 15.0737 6.17388 12.0569C6.17388 9.04022 8.72666 6.59442 11.8753 6.59442C15.024 6.59442 17.5768 9.04022 17.5768 12.0569C17.5768 15.0737 15.024 17.5195 11.8753 17.5195Z",fill:"white"}))});(0,a.registerBlockType)("qsm/quiz",{icon:f,edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:a,isSelected:r,clientId:z}=e,{createNotice:w}=(0,m.useDispatch)(c.store),b=qsmBlockData.globalQuizsetting,{quizID:v,postID:y,quizAttr:E=b}=n,[k,D]=(0,i.useState)(qsmBlockData.QSMQuizList),[I,x]=(0,i.useState)({error:!1,msg:""}),[B,C]=(0,i.useState)(!1),[S,O]=(0,i.useState)(!1),[P,N]=(0,i.useState)(!1),[A,M]=(0,i.useState)([]),T=qsmBlockData.quizOptions,Q=(0,m.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(p.store);return n()&&!t()}),[]),{getBlock:j}=(0,m.useSelect)(u.store);(0,i.useEffect)((()=>{let e=!0;if(e&&("0"==qsmBlockData.is_pro_activated&&setTimeout((()=>{H()}),100),!_(v)&&0<v)){let e=!1;k.forEach((t=>{if(v==t.value)return e=!0,!0})),e?F(v):(a({quizID:void 0}),x({error:!0,msg:(0,s.__)("Quiz not found. Please select an existing quiz or create a new one.","quiz-master-next")}))}return()=>{e=!1}}),[]);const H=()=>{let e=document.getElementById("modal-advanced-question-type");_(e)&&o()({path:"/quiz-survey-master/v1/quiz/advance-ques-type-upgrade-popup",method:"POST"}).then((e=>{let t=document.getElementById("wpbody-content");_(t)||"success"!=e.status||t.insertAdjacentHTML("afterbegin",e.result)})).catch((e=>{console.log("error",e)}))},F=e=>{!_(e)&&0<e&&o()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:e}}).then((t=>{if("success"==t.status){x({error:!1,msg:""});let n=t.result;if(a({quizID:parseInt(e),postID:n.post_id,quizAttr:{...E,...n}}),!_(n.qpages)){let e=[];n.qpages.forEach((t=>{let n=[];_(t.question_arr)||t.question_arr.forEach((e=>{if(!_(e)){let t=[];!_(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2],caption:h(e[3])}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:e.settings.required,hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),M(e)}}else console.log("error "+t.msg)})).catch((e=>{console.log("error",e)}))},L=(e,t)=>{let n=E;n[t]=e,a({quizAttr:{...n}})};(0,i.useEffect)((()=>{if(Q){let e=(()=>{let e=j(z);if(_(e))return!1;e=e.innerBlocks;let t={quiz_id:E.quiz_id,post_id:E.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let a=e.attributes.pageID,i=[];!_(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let a=e.attributes,s=h(a?.answerEditor,"text"),r=[];!_(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes,n=h(t?.content);_(a?.answerEditor)||"rich"!==a.answerEditor||(n=d((0,l.decodeEntities)(n)));let i=[n,h(t?.points),h(t?.isCorrect)];"image"!==s||_(t?.caption)||i.push(t?.caption),r.push(i)})),i.push(a.questionID),a.isChanged&&t.questions.push({id:a.questionID,quizID:E.quiz_id,postID:E.post_id,answerEditor:s,type:h(a?.type,"0"),name:d(h(a?.description)),question_title:h(a?.title),answerInfo:d(h(a?.correctAnswerInfo)),comments:h(a?.commentBox,"1"),hint:h(a?.hint),category:h(a?.category),multicategories:h(a?.multicategories,[]),required:h(a?.required,0),answers:r,featureImageID:h(a?.featureImageID),featureImageSrc:h(a?.featureImageSrc),page:n,other_settings:{required:h(a?.required,0)}})})),t.pages.push(i),t.qpages.push({id:a,quizID:E.quiz_id,pagekey:e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:i}),n++}})),t.quiz={quiz_name:E.quiz_name,quiz_id:E.quiz_id,post_id:E.post_id},P&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==E[e]&&null!==E[e]&&(t.quiz[e]=E[e])})),t})();O(!0),e=g({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,nonce:qsmBlockData.saveNonce}),o()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{w(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),w("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[Q]);const $=(0,u.useBlockProps)(),K=(0,u.useInnerBlocksProps)($,{template:A,allowedBlocks:["qsm/quiz-page"]});return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(u.InspectorControls,null,(0,i.createElement)(q.PanelBody,{title:(0,s.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,i.createElement)("label",{className:"qsm-inspector-label"},(0,s.__)("Status","quiz-master-next")+":",(0,i.createElement)("span",{className:"qsm-inspector-label-value"},E.post_status)),(0,i.createElement)(q.TextControl,{label:(0,s.__)("Quiz Name *","quiz-master-next"),help:(0,s.__)("Enter a name for this Quiz","quiz-master-next"),value:E?.quiz_name||"",onChange:e=>L(e,"quiz_name"),className:"qsm-no-mb"}),(!_(v)||"0"!=v)&&(0,i.createElement)("p",null,(0,i.createElement)(q.ExternalLink,{href:qsmBlockData.quiz_settings_url+"&quiz_id="+v},(0,s.__)("Advance Quiz Settings","quiz-master-next"))))),_(v)||"0"==v?(0,i.createElement)(q.Placeholder,{className:"qsm-placeholder-wrapper",icon:f,label:(0,s.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,s.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,i.createElement)(i.Fragment,null,!_(k)&&0<k.length&&(0,i.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,i.createElement)(q.SelectControl,{label:(0,s.__)("","quiz-master-next"),value:v,options:k,onChange:e=>F(e),disabled:B,__nextHasNoMarginBottom:!0}),(0,i.createElement)("span",null,(0,s.__)("OR","quiz-master-next")),(0,i.createElement)(q.Button,{variant:"link",onClick:()=>C(!B)},(0,s.__)("Add New","quiz-master-next"))),(_(k)||B)&&(0,i.createElement)(q.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,i.createElement)(q.TextControl,{label:(0,s.__)("Quiz Name *","quiz-master-next"),help:(0,s.__)("Enter a name for this Quiz","quiz-master-next"),value:E?.quiz_name||"",onChange:e=>L(e,"quiz_name")}),(0,i.createElement)(q.Button,{variant:"link",onClick:()=>N(!P)},(0,s.__)("Advance options","quiz-master-next")),P&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)(q.SelectControl,{label:T?.form_type?.label,value:E?.form_type,options:T?.form_type?.options,onChange:e=>L(e,"form_type"),__nextHasNoMarginBottom:!0}),(0,i.createElement)(q.SelectControl,{label:T?.system?.label,value:E?.system,options:T?.system?.options,onChange:e=>L(e,"system"),help:T?.system?.help,__nextHasNoMarginBottom:!0}),["timer_limit","pagination"].map((e=>(0,i.createElement)(q.TextControl,{key:"quiz-create-text-"+e,type:"number",label:T?.[e]?.label,help:T?.[e]?.help,value:_(E[e])?0:E[e],onChange:t=>L(t,e)}))),["enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].map((e=>(0,i.createElement)(q.ToggleControl,{key:"quiz-create-toggle-"+e,label:T?.[e]?.label,help:T?.[e]?.help,checked:!_(E[e])&&"1"==E[e],onChange:()=>L(_(E[e])||"1"!=E[e]?1:0,e)})))),(0,i.createElement)(q.Button,{variant:"primary",disabled:S||_(E.quiz_name),onClick:()=>(()=>{if(_(E.quiz_name))return void console.log("empty quiz_name");O(!0);let e=g({quiz_name:E.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===E[t]||null===E[t]?"":e.append(t,E[t]))),o()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(O(!1),"success"==e.status){let t=g({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:1,answers:[],page:0});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if("success"==t.status){let n=t.id,a=g({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});a.append("pages[0][]",n),a.append("qpages[0][id]",1),a.append("qpages[0][quizID]",e.quizID),a.append("qpages[0][pagekey]",((e="",t=!1)=>`${e}${(1e3*Date.now()+Math.floor(1e3*Math.random())).toString(16).replace(/\./g,"").padEnd(8,"0")}${t?`.${Math.floor(1e8*Math.random())}`:""}`)()),a.append("qpages[0][hide_prevbtn]",0),a.append("qpages[0][questions][]",n),o()({url:qsmBlockData.ajax_url,method:"POST",body:a}).then((t=>{"success"==t.status&&F(e.quizID)}))}})).catch((e=>{console.log("error",e),w("error",e.message,{isDismissible:!0,type:"snackbar"})}))}w(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),w("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,s.__)("Create Quiz","quiz-master-next"))),I.error&&(0,i.createElement)("p",{className:"qsm-error-text"},I.msg))):(0,i.createElement)("div",{...K}))},save:e=>null})}},n={};function a(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=function(t,n,i,s){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],s=e[c][2];for(var o=!0,l=0;l<n.length;l++)(!1&s||r>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(o=!1,s<r&&(r=s));if(o){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[n,i,s]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,s,r=n[0],o=n[1],l=n[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(l)var c=l(a)}for(t&&t(n);u<r.length;u++)s=r[u],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(c)},n=self.webpackChunkqsm=self.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var i=a.O(void 0,[431],(function(){return a(775)}));i=a.O(i)}();