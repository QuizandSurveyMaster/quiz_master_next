!function(){"use strict";var e,t={775:function(e,t,n){var i=window.wp.blocks,a=window.wp.element,s=window.wp.i18n,r=window.wp.apiFetch,o=n.n(r),u=window.wp.htmlEntities,l=window.wp.blockEditor,c=window.wp.notices,m=window.wp.data,p=window.wp.editor,q=window.wp.components;const _=e=>null==e||""===e,d=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},g=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},h=e=>{let t="";const n=new Uint8Array(e);window.crypto.getRandomValues(n);for(let i=0;i<e;i++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[n[i]%62];return t},f=(e="",t=!1)=>`${e}${h(8)}${t?`.${h(7)}`:""}`,z=(e,t="")=>_(e)?t:e,w=()=>(0,a.createElement)(q.Icon,{icon:()=>(0,a.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("rect",{width:"24",height:"24",rx:"3",fill:"black"}),(0,a.createElement)("path",{d:"M17.8146 17.8349C19.3188 16.3426 20.25 14.2793 20.25 12C20.2485 7.44425 16.5267 3.75 11.9348 3.75C7.34282 3.75 3.62109 7.44425 3.62109 12C3.62109 16.5558 7.34282 20.25 11.9348 20.25H18.9988C19.4682 20.25 19.7074 19.7112 19.3813 19.3885L17.8146 17.8334V17.8349ZM11.8753 17.5195C8.72666 17.5195 6.17388 15.0737 6.17388 12.0569C6.17388 9.04022 8.72666 6.59442 11.8753 6.59442C15.024 6.59442 17.5768 9.04022 17.5768 12.0569C17.5768 15.0737 15.024 17.5195 11.8753 17.5195Z",fill:"white"}))});(0,i.registerBlockType)("qsm/quiz",{icon:w,edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:i,isSelected:r,clientId:h}=e,{createNotice:b}=(0,m.useDispatch)(c.store),v=qsmBlockData.globalQuizsetting,{quizID:y,postID:E,quizAttr:k=v}=n,[D,I]=(0,a.useState)(qsmBlockData.QSMQuizList),[x,B]=(0,a.useState)({error:!1,msg:""}),[C,S]=(0,a.useState)(!1),[O,P]=(0,a.useState)(!1),[N,A]=(0,a.useState)(!1),[T,Q]=(0,a.useState)([]),M=qsmBlockData.quizOptions,j=(0,m.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(p.store);return n()&&!t()}),[]),{getBlock:H}=(0,m.useSelect)(l.store);(0,a.useEffect)((()=>{let e=!0;if(e&&("0"==qsmBlockData.is_pro_activated&&setTimeout((()=>{F()}),100),!_(y)&&0<y)){let e=!1;D.forEach((t=>{if(y==t.value)return e=!0,!0})),e?L(y):(i({quizID:void 0}),B({error:!0,msg:(0,s.__)("Quiz not found. Please select an existing quiz or create a new one.","quiz-master-next")}))}return()=>{e=!1}}),[]);const F=()=>{let e=document.getElementById("modal-advanced-question-type");_(e)&&o()({path:"/quiz-survey-master/v1/quiz/advance-ques-type-upgrade-popup",method:"POST"}).then((e=>{let t=document.getElementById("wpbody-content");_(t)||"success"!=e.status||t.insertAdjacentHTML("afterbegin",e.result)})).catch((e=>{console.log("error",e)}))},L=e=>{!_(e)&&0<e&&o()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:e}}).then((t=>{if("success"==t.status){B({error:!1,msg:""});let n=t.result;if(i({quizID:parseInt(e),postID:n.post_id,quizAttr:{...k,...n}}),!_(n.qpages)){let e=[];n.qpages.forEach((t=>{let n=[];_(t.question_arr)||t.question_arr.forEach((e=>{if(!_(e)){let t=[];!_(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2],caption:z(e[3])}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:e.settings.required,hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),Q(e)}}else console.log("error "+t.msg)})).catch((e=>{console.log("error",e)}))},K=(e,t)=>{let n=k;n[t]=e,i({quizAttr:{...n}})};(0,a.useEffect)((()=>{if(j){let e=(()=>{let e=H(h);if(_(e))return!1;e=e.innerBlocks;let t={quiz_id:k.quiz_id,post_id:k.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let i=e.attributes.pageID,a=[];!_(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let i=e.attributes,s=z(i?.answerEditor,"text"),r=[];!_(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes,n=z(t?.content);_(i?.answerEditor)||"rich"!==i.answerEditor||(n=d((0,u.decodeEntities)(n)));let a=[n,z(t?.points),z(t?.isCorrect)];"image"!==s||_(t?.caption)||a.push(t?.caption),r.push(a)})),a.push(i.questionID),i.isChanged&&t.questions.push({id:i.questionID,quizID:k.quiz_id,postID:k.post_id,answerEditor:s,type:z(i?.type,"0"),name:d(z(i?.description)),question_title:z(i?.title),answerInfo:d(z(i?.correctAnswerInfo)),comments:z(i?.commentBox,"1"),hint:z(i?.hint),category:z(i?.category),multicategories:z(i?.multicategories,[]),required:z(i?.required,0),answers:r,featureImageID:z(i?.featureImageID),featureImageSrc:z(i?.featureImageSrc),page:n,other_settings:{required:z(i?.required,0)}})})),t.pages.push(a),t.qpages.push({id:i,quizID:k.quiz_id,pagekey:_(e.attributes.pageKey)?f():e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:a}),n++}})),t.quiz={quiz_name:k.quiz_name,quiz_id:k.quiz_id,post_id:k.post_id},N&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==k[e]&&null!==k[e]&&(t.quiz[e]=k[e])})),t})();P(!0),e=g({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,nonce:qsmBlockData.saveNonce}),o()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{b(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),b("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[j]);const V=(0,l.useBlockProps)(),$=(0,l.useInnerBlocksProps)(V,{template:T,allowedBlocks:["qsm/quiz-page"]});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(l.InspectorControls,null,(0,a.createElement)(q.PanelBody,{title:(0,s.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,a.createElement)("label",{className:"qsm-inspector-label"},(0,s.__)("Status","quiz-master-next")+":",(0,a.createElement)("span",{className:"qsm-inspector-label-value"},k.post_status)),(0,a.createElement)(q.TextControl,{label:(0,s.__)("Quiz Name *","quiz-master-next"),help:(0,s.__)("Enter a name for this Quiz","quiz-master-next"),value:k?.quiz_name||"",onChange:e=>K(e,"quiz_name"),className:"qsm-no-mb"}),(!_(y)||"0"!=y)&&(0,a.createElement)("p",null,(0,a.createElement)(q.ExternalLink,{href:qsmBlockData.quiz_settings_url+"&quiz_id="+y},(0,s.__)("Advance Quiz Settings","quiz-master-next"))))),_(y)||"0"==y?(0,a.createElement)(q.Placeholder,{className:"qsm-placeholder-wrapper",icon:w,label:(0,s.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,s.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,a.createElement)(a.Fragment,null,!_(D)&&0<D.length&&(0,a.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,a.createElement)(q.SelectControl,{label:(0,s.__)("","quiz-master-next"),value:y,options:D,onChange:e=>L(e),disabled:C,__nextHasNoMarginBottom:!0}),(0,a.createElement)("span",null,(0,s.__)("OR","quiz-master-next")),(0,a.createElement)(q.Button,{variant:"link",onClick:()=>S(!C)},(0,s.__)("Add New","quiz-master-next"))),(_(D)||C)&&(0,a.createElement)(q.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,a.createElement)(q.TextControl,{label:(0,s.__)("Quiz Name *","quiz-master-next"),help:(0,s.__)("Enter a name for this Quiz","quiz-master-next"),value:k?.quiz_name||"",onChange:e=>K(e,"quiz_name")}),(0,a.createElement)(q.Button,{variant:"link",onClick:()=>A(!N)},(0,s.__)("Advance options","quiz-master-next")),N&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(q.SelectControl,{label:M?.form_type?.label,value:k?.form_type,options:M?.form_type?.options,onChange:e=>K(e,"form_type"),__nextHasNoMarginBottom:!0}),(0,a.createElement)(q.SelectControl,{label:M?.system?.label,value:k?.system,options:M?.system?.options,onChange:e=>K(e,"system"),help:M?.system?.help,__nextHasNoMarginBottom:!0}),["timer_limit","pagination"].map((e=>(0,a.createElement)(q.TextControl,{key:"quiz-create-text-"+e,type:"number",label:M?.[e]?.label,help:M?.[e]?.help,value:_(k[e])?0:k[e],onChange:t=>K(t,e)}))),["enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].map((e=>(0,a.createElement)(q.ToggleControl,{key:"quiz-create-toggle-"+e,label:M?.[e]?.label,help:M?.[e]?.help,checked:!_(k[e])&&"1"==k[e],onChange:()=>K(_(k[e])||"1"!=k[e]?1:0,e)})))),(0,a.createElement)(q.Button,{variant:"primary",disabled:O||_(k.quiz_name),onClick:()=>(()=>{if(_(k.quiz_name))return void console.log("empty quiz_name");P(!0);let e=g({quiz_name:k.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===k[t]||null===k[t]?"":e.append(t,k[t]))),o()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(P(!1),"success"==e.status){let t=g({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:1,answers:[],page:0});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if("success"==t.status){let n=t.id,i=g({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});i.append("pages[0][]",n),i.append("qpages[0][id]",1),i.append("qpages[0][quizID]",e.quizID),i.append("qpages[0][pagekey]",f()),i.append("qpages[0][hide_prevbtn]",0),i.append("qpages[0][questions][]",n),o()({url:qsmBlockData.ajax_url,method:"POST",body:i}).then((t=>{"success"==t.status&&L(e.quizID)}))}})).catch((e=>{console.log("error",e),b("error",e.message,{isDismissible:!0,type:"snackbar"})}))}b(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),b("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,s.__)("Create Quiz","quiz-master-next"))),x.error&&(0,a.createElement)("p",{className:"qsm-error-text"},x.msg))):(0,a.createElement)("div",{...$}))},save:e=>null})}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,i),s.exports}i.m=t,e=[],i.O=function(t,n,a,s){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],s=e[c][2];for(var o=!0,u=0;u<n.length;u++)(!1&s||r>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[u])}))?n.splice(u--,1):(o=!1,s<r&&(r=s));if(o){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[n,a,s]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,r=n[0],o=n[1],u=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(u)var c=u(i)}for(t&&t(n);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(c)},n=self.webpackChunkqsm=self.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=i.O(void 0,[431],(function(){return i(775)}));a=i.O(a)}();