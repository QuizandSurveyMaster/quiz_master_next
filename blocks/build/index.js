!function(){"use strict";var e,t={758:function(e,t,n){var i=window.wp.blocks,s=window.wp.element,a=window.wp.i18n,o=window.wp.apiFetch,r=n.n(o),u=window.wp.blockEditor,l=window.wp.notices,c=window.wp.data,m=window.wp.editor,p=window.wp.components;const q=e=>null==e||""===e,_=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},d=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},g=(e,t="")=>q(e)?t:e;(0,i.registerBlockType)("qsm/quiz",{edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:i,isSelected:o,clientId:z}=e,{createNotice:h}=(0,c.useDispatch)(l.store),{quizID:f,quizAttr:b}=n,[w,v]=(qsmBlockData.globalQuizsetting,(0,s.useState)(qsmBlockData.QSMQuizList)),[y,k]=(0,s.useState)({error:!1,msg:""}),[D,E]=(0,s.useState)(!1),[I,B]=(0,s.useState)(!1),[x,S]=(0,s.useState)(!1),[C,O]=(0,s.useState)([]),P=qsmBlockData.quizOptions,N=(0,c.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(m.store);return n()&&!t()}),[]),{getBlock:A}=(0,c.useSelect)(u.store);(0,s.useEffect)((()=>{let e=!0;return e&&!q(f)&&0<f&&r()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:f}}).then((e=>{if(console.log("quiz render data",e),"success"==e.status){let t=e.result;if(i({quizAttr:{...t}}),!q(t.qpages)){let e=[];t.qpages.forEach((t=>{let n=[];q(t.question_arr)||t.question_arr.forEach((e=>{if(!q(e)){let t=[];!q(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2]}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:e.settings.required,hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),O(e)}}else console.log("error "+e.msg)})),()=>{e=!1}}),[f]);const T=(e,t)=>{let n=b;n[t]=e,i({quizAttr:{...n}})};(0,s.useEffect)((()=>{if(N){let e=(()=>{let e=A(z);if(q(e))return!1;console.log("blocks",e),e=e.innerBlocks;let t={quiz_id:b.quiz_id,post_id:b.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let i=e.attributes.pageID,s=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let i=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes;i.push([g(t?.content),g(t?.points),g(t?.isCorrect)])}));let a=e.attributes;s.push(a.questionID),t.questions.push({id:a.questionID,quizID:b.quiz_id,postID:b.post_id,answerEditor:g(a?.answerEditor,"text"),type:g(a?.type,"0"),name:_(g(a?.description)),question_title:g(a?.title),answerInfo:_(g(a?.correctAnswerInfo)),comments:g(a?.commentBox,"1"),hint:g(a?.hint),category:g(a?.category),multicategories:[],required:g(a?.required,1),answers:i,page:n})})),t.pages.push(s),t.qpages.push({id:i,quizID:b.quiz_id,pagekey:e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:s}),n++}})),t.quiz={quiz_name:b.quiz_name,quiz_id:b.quiz_id,post_id:b.post_id},x&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==b[e]&&null!==b[e]&&(t.quiz[e]=b[e])})),t})();console.log("quizData",e),B(!0),e=d({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,nonce:qsmBlockData.saveNonce}),r()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{console.log(e)})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[N]);const M=(0,u.useBlockProps)(),Q=(0,u.useInnerBlocksProps)(M,{template:C,allowedBlocks:["qsm/quiz-page"]});return(0,s.createElement)(s.Fragment,null,(0,s.createElement)(u.InspectorControls,null,(0,s.createElement)(p.PanelBody,{title:(0,a.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,s.createElement)(p.TextControl,{label:(0,a.__)("Quiz Name *","quiz-master-next"),help:(0,a.__)("Enter a name for this Quiz","quiz-master-next"),value:b?.quiz_name||"",onChange:e=>T(e,"quiz_name")}))),q(f)||"0"==f?(0,s.createElement)(p.Placeholder,{icon:()=>(0,s.createElement)(p.Icon,{icon:"vault",size:"36"}),label:(0,a.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,a.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,s.createElement)(s.Fragment,null,!q(w)&&0<w.length&&(0,s.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,s.createElement)(p.SelectControl,{label:(0,a.__)("","quiz-master-next"),value:f,options:w,onChange:e=>i({quizID:e}),disabled:D,__nextHasNoMarginBottom:!0}),(0,s.createElement)("span",null,(0,a.__)("OR","quiz-master-next")),(0,s.createElement)(p.Button,{variant:"link",onClick:()=>E(!D)},(0,a.__)("Add New","quiz-master-next"))),(q(w)||D)&&(0,s.createElement)(p.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,s.createElement)(p.TextControl,{label:(0,a.__)("Quiz Name *","quiz-master-next"),help:(0,a.__)("Enter a name for this Quiz","quiz-master-next"),value:b?.quiz_name||"",onChange:e=>T(e,"quiz_name")}),(0,s.createElement)(p.Button,{variant:"link",onClick:()=>S(!x)},(0,a.__)("Advance options","quiz-master-next")),x&&(0,s.createElement)(s.Fragment,null,(0,s.createElement)(p.SelectControl,{label:P?.form_type?.label,value:b?.form_type,options:P?.form_type?.options,onChange:e=>T(e,"form_type"),__nextHasNoMarginBottom:!0}),(0,s.createElement)(p.SelectControl,{label:P?.system?.label,value:b?.system,options:P?.system?.options,onChange:e=>T(e,"system"),help:P?.system?.help,__nextHasNoMarginBottom:!0}),["timer_limit","pagination"].map((e=>(0,s.createElement)(p.TextControl,{key:"quiz-create-text-"+e,type:"number",label:P?.[e]?.label,help:P?.[e]?.help,value:q(b[e])?0:b[e],onChange:t=>T(t,e)}))),["enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].map((e=>(0,s.createElement)(p.ToggleControl,{key:"quiz-create-toggle-"+e,label:P?.[e]?.label,help:P?.[e]?.help,checked:!q(b[e])&&"1"==b[e],onChange:()=>T(q(b[e])||"1"!=b[e]?1:0,e)})))),(0,s.createElement)(p.Button,{variant:"primary",disabled:I||q(b.quiz_name),onClick:()=>(()=>{if(q(b.quiz_name))return void console.log("empty quiz_name");B(!0);let e=d({quiz_name:b.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});x&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===b[t]||null===b[t]?"":e.append(t,b[t]))),r()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(console.log(e),B(!1),"success"==e.status){let t=d({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:1,answers:[],page:0});r()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if(console.log("question response",t),"success"==t.status){let n=t.id,s=d({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});s.append("pages[0][]",n),s.append("qpages[0][id]",1),s.append("qpages[0][quizID]",e.quizID),s.append("qpages[0][pagekey]",((e="",t=!1)=>`${e}${(1e3*Date.now()+1e3*Math.random()).toString(16).replace(/\./g,"").padEnd(8,"0")}${t?`.${Math.trunc(1e8*Math.random())}`:""}`)()),s.append("qpages[0][hide_prevbtn]",0),s.append("qpages[0][questions][]",n),r()({url:qsmBlockData.ajax_url,method:"POST",body:s}).then((t=>{console.log("pageResponse",t),"success"==t.status&&i({quizID:e.quizID})}))}})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))}h(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,a.__)("Create Quiz","quiz-master-next"))))):(0,s.createElement)("div",{...Q}))},save:e=>null})}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,e=[],i.O=function(t,n,s,a){if(!n){var o=1/0;for(c=0;c<e.length;c++){n=e[c][0],s=e[c][1],a=e[c][2];for(var r=!0,u=0;u<n.length;u++)(!1&a||o>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[u])}))?n.splice(u--,1):(r=!1,a<o&&(o=a));if(r){e.splice(c--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,s,a]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,a,o=n[0],r=n[1],u=n[2],l=0;if(o.some((function(t){return 0!==e[t]}))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(u)var c=u(i)}for(t&&t(n);l<o.length;l++)a=o[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(c)},n=self.webpackChunkqsm=self.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var s=i.O(void 0,[431],(function(){return i(758)}));s=i.O(s)}();