(()=>{"use strict";var e,t={550:(e,t,n)=>{const s=window.wp.blocks,a=window.wp.element,i=window.wp.i18n,r=window.wp.apiFetch;var o=n.n(r);const l=window.wp.htmlEntities,u=window.wp.blockEditor,c=window.wp.notices,m=window.wp.data,p=window.wp.editor,d=window.wp.components,q=e=>null==e||""===e,g=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},_=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},h=e=>{let t="";const n=new Uint8Array(e);window.crypto.getRandomValues(n);for(let s=0;s<e;s++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[n[s]%62];return t},z=(e="",t=!1)=>`${e}${h(8)}${t?`.${h(7)}`:""}`,b=(e,t="")=>q(e)?t:e,w=window.wp.escapeHtml,f=()=>{};function v({className:e="",quizAttr:t,setAttributes:n,data:s,onChangeFunc:i=f}){var r,o,l,u,c;const m=(()=>{if(s.defaultvalue=s.default,!q(s?.options))switch(s.type){case"checkbox":1===s.options.length&&(s.type="toggle"),s.label=s.options[0].label;break;case"radio":1==s.options.length?(s.label=s.options[0].label,s.type="toggle"):s.type="select"}return s.label=q(s.label)?"":(0,w.escapeAttribute)(s.label),s.help=q(s.help)?"":(0,w.escapeAttribute)(s.help),s})(),{id:p,label:g="",type:_,help:h="",options:z=[],defaultvalue:b}=m;return(0,a.createElement)(a.Fragment,null,"toggle"===_&&(0,a.createElement)(d.ToggleControl,{label:g,help:h,checked:!q(t[p])&&"1"==t[p],onChange:()=>i(q(t[p])||"1"!=t[p]?1:0,p)}),"select"===_&&(0,a.createElement)(d.SelectControl,{label:g,value:null!==(r=t[p])&&void 0!==r?r:b,options:z,onChange:e=>i(e,p),help:h,__nextHasNoMarginBottom:!0}),"number"===_&&(0,a.createElement)(d.TextControl,{type:"number",label:g,value:null!==(o=t[p])&&void 0!==o?o:b,onChange:e=>i(e,p),help:h,__nextHasNoMarginBottom:!0}),"text"===_&&(0,a.createElement)(d.TextControl,{type:"text",label:g,value:null!==(l=t[p])&&void 0!==l?l:b,onChange:e=>i(e,p),help:h,__nextHasNoMarginBottom:!0}),"textarea"===_&&(0,a.createElement)(d.TextareaControl,{label:g,value:null!==(u=t[p])&&void 0!==u?u:b,onChange:e=>i(e,p),help:h,__nextHasNoMarginBottom:!0}),"checkbox"===_&&(0,a.createElement)(d.CheckboxControl,{label:g,help:h,checked:!q(t[p])&&"1"==t[p],onChange:()=>i(q(t[p])||"1"!=t[p]?1:0,p)}),"radio"===_&&(0,a.createElement)(d.RadioControl,{label:g,help:h,selected:null!==(c=t[p])&&void 0!==c?c:b,options:z,onChange:e=>i(e,p)}))}const y=()=>(0,a.createElement)(d.Icon,{icon:()=>(0,a.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("rect",{width:"24",height:"24",rx:"3",fill:"black"}),(0,a.createElement)("path",{d:"M17.8146 17.8349C19.3188 16.3426 20.25 14.2793 20.25 12C20.2485 7.44425 16.5267 3.75 11.9348 3.75C7.34282 3.75 3.62109 7.44425 3.62109 12C3.62109 16.5558 7.34282 20.25 11.9348 20.25H18.9988C19.4682 20.25 19.7074 19.7112 19.3813 19.3885L17.8146 17.8334V17.8349ZM11.8753 17.5195C8.72666 17.5195 6.17388 15.0737 6.17388 12.0569C6.17388 9.04022 8.72666 6.59442 11.8753 6.59442C15.024 6.59442 17.5768 9.04022 17.5768 12.0569C17.5768 15.0737 15.024 17.5195 11.8753 17.5195Z",fill:"white"}))});window.wp.compose,(0,s.registerBlockType)("qsm/quiz",{icon:y,edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:s,isSelected:r,clientId:h,context:w}=e,f=w.postId,{createNotice:E}=(0,m.useDispatch)(c.store),k=qsmBlockData.globalQuizsetting,{quizID:x,postID:D,quizAttr:I=k}=n,[C,B]=(0,a.useState)(qsmBlockData.QSMQuizList),[S,P]=(0,a.useState)({error:!1,msg:""}),[A,N]=(0,a.useState)(!1),[O,T]=(0,a.useState)(!1),[M,Q]=(0,a.useState)(!1),[H,F]=(0,a.useState)([]),j=qsmBlockData.quizOptions,L=(0,m.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(p.store);return n()&&!t()}),[]),K=(0,m.useSelect)((e=>e("core/editor")),[]),{getBlock:R}=(0,m.useSelect)(u.store);(0,a.useEffect)((()=>{let e=!0;if(e&&("0"==qsmBlockData.is_pro_activated&&setTimeout((()=>{V()}),100),!q(x)&&0<x)){let e=!1;C.forEach((t=>{if(x==t.value)return e=!0,!0})),e?$(x):(s({quizID:void 0}),P({error:!0,msg:(0,i.__)("Quiz not found. Please select an existing quiz or create a new one.","quiz-master-next")}))}return()=>{e=!1}}),[]);const V=()=>{let e=document.getElementById("modal-advanced-question-type");q(e)&&o()({path:"/quiz-survey-master/v1/quiz/advance-ques-type-upgrade-popup",method:"POST"}).then((e=>{let t=document.getElementById("wpbody-content");q(t)||"success"!=e.status||t.insertAdjacentHTML("afterbegin",e.result)})).catch((e=>{console.log("error",e)}))},$=e=>{!q(e)&&0<e&&o()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:e}}).then((t=>{if("success"==t.status){P({error:!1,msg:""});let n=t.result;if(s({quizID:parseInt(e),postID:n.post_id,quizAttr:{...I,...n}}),!q(n.qpages)){let e=[];n.qpages.forEach((t=>{let n=[];q(t.question_arr)||t.question_arr.forEach((e=>{if(!q(e)){let t=[];!q(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2],caption:b(e[3])}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,isPublished:void 0!==e.settings.isPublished?e.settings.isPublished:1,linked_question:void 0!==e.linked_question?e.linked_question:"",type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:"0"==e.settings.required?"1":"0",hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),F(e)}}else console.log("error "+t.msg)})).catch((e=>{console.log("error",e)}))},Z=(e,t)=>{let n=I;n[t]=e,s({quizAttr:{...n}})};(0,a.useEffect)((()=>{if(L){let e=(()=>{let e=R(h);if(q(e))return!1;e=e.innerBlocks;let t={quiz_id:I.quiz_id,post_id:I.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let s=e.attributes.pageID,a=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let s=e.attributes,i=b(s?.answerEditor,"text"),r=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes,n=b(t?.content);q(s?.answerEditor)||"rich"!==s.answerEditor||(n=g((0,l.decodeEntities)(n)));let a=[n,b(t?.points),b(t?.isCorrect)];"image"!==i||q(t?.caption)||a.push(t?.caption),r.push(a)})),a.push(s.questionID),s.isChanged&&t.questions.push({id:s.questionID,quizID:I.quiz_id,postID:I.post_id,answerEditor:i,type:b(s?.type,"0"),name:g(b(s?.description)),question_title:b(s?.title),answerInfo:g(b(s?.correctAnswerInfo)),comments:b(s?.commentBox,"1"),hint:b(s?.hint),category:b(s?.category),multicategories:b(s?.multicategories,[]),required:"0"==b(s?.required,"1")?"1":"0",is_published:b(s?.isPublished,1),merged_question:b(s?.linked_question,""),answers:r,featureImageID:b(s?.featureImageID),featureImageSrc:b(s?.featureImageSrc),page:n,other_settings:{...b(s?.settings,{}),required:"0"==b(s?.required,"1")?"1":"0",isPublished:b(s?.isPublished,1),question_title:b(s?.title),answerEditor:i}})})),t.pages.push(a),t.qpages.push({id:s,quizID:I.quiz_id,pagekey:q(e.attributes.pageKey)?z():e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:a}),n++}})),t.quiz={quiz_name:I.quiz_name,quiz_id:I.quiz_id,post_id:I.post_id},M&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==I[e]&&null!==I[e]&&(t.quiz[e]=I[e])})),t})();T(!0);let t="publish";q(K)||(t=K.getEditedPostAttribute("status")),q(t)&&(t="publish"),e=_({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,page_post_id:q(f)?0:f,post_status:t,nonce:qsmBlockData.saveNonce}),o()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{E(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),E("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[L]);const J=(0,u.useBlockProps)(),U=(0,u.useInnerBlocksProps)(J,{template:H,allowedBlocks:["qsm/quiz-page"]});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(u.InspectorControls,null,(0,a.createElement)(d.PanelBody,{title:(0,i.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,a.createElement)("label",{className:"qsm-inspector-label"},(0,i.__)("Status","quiz-master-next")+":",(0,a.createElement)("span",{className:"qsm-inspector-label-value"},I.post_status)),(0,a.createElement)(d.TextControl,{label:(0,i.__)("Quiz Name *","quiz-master-next"),help:(0,i.__)("Enter a name for this Quiz","quiz-master-next"),value:I?.quiz_name||"",onChange:e=>Z(e,"quiz_name"),className:"qsm-no-mb"}),(!q(x)||"0"!=x)&&(0,a.createElement)("p",null,(0,a.createElement)(d.ExternalLink,{href:qsmBlockData.quiz_settings_url+"&quiz_id="+x+"&tab=options"},(0,i.__)("Advance Quiz Settings","quiz-master-next"))))),q(x)||"0"==x?(0,a.createElement)("div",{...J}," ",(0,a.createElement)(d.Placeholder,{className:"qsm-placeholder-wrapper",icon:y,label:(0,i.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,i.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,a.createElement)(a.Fragment,null,!q(C)&&0<C.length&&(0,a.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,a.createElement)(d.SelectControl,{label:(0,i.__)("","quiz-master-next"),value:x,options:C,onChange:e=>$(e),disabled:A,__nextHasNoMarginBottom:!0}),(0,a.createElement)("span",null,(0,i.__)("OR","quiz-master-next")),(0,a.createElement)(d.Button,{variant:"link",onClick:()=>N(!A)},(0,i.__)("Add New","quiz-master-next"))),(q(C)||A)&&(0,a.createElement)(d.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,a.createElement)(d.TextControl,{label:(0,i.__)("Quiz Name *","quiz-master-next"),help:(0,i.__)("Enter a name for this Quiz","quiz-master-next"),value:I?.quiz_name||"",onChange:e=>Z(e,"quiz_name")}),(0,a.createElement)(d.Button,{variant:"link",onClick:()=>Q(!M)},(0,i.__)("Advance options","quiz-master-next")),(0,a.createElement)("div",{className:"qsm-advance-settings"},M&&j.map((e=>0!=I.form_type&&"system"==e.id?null:(0,a.createElement)(v,{key:"qsm-settings"+e.id,data:e,quizAttr:I,setAttributes:s,onChangeFunc:Z})))),(0,a.createElement)(d.Button,{variant:"primary",disabled:O||q(I.quiz_name),onClick:()=>(()=>{if(q(I.quiz_name))return void console.log("empty quiz_name");T(!0);let e=_({quiz_name:I.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===I[t]||null===I[t]?"":e.append(t,I[t]))),o()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(T(!1),"success"==e.status){let t=_({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:0,isPublished:1,answers:[],page:0});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if("success"==t.status){let n=t.id,s=_({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});s.append("pages[0][]",n),s.append("qpages[0][id]",1),s.append("qpages[0][quizID]",e.quizID),s.append("qpages[0][pagekey]",z()),s.append("qpages[0][hide_prevbtn]",0),s.append("qpages[0][questions][]",n),o()({url:qsmBlockData.ajax_url,method:"POST",body:s}).then((t=>{"success"==t.status&&$(e.quizID)}))}})).catch((e=>{console.log("error",e),E("error",e.message,{isDismissible:!0,type:"snackbar"})}))}E(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),E("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,i.__)("Create Quiz","quiz-master-next"))),S.error&&(0,a.createElement)("p",{className:"qsm-error-text"},S.msg)))," "):(0,a.createElement)("div",{...U}))},save:e=>null})}},n={};function s(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,s),i.exports}s.m=t,e=[],s.O=(t,n,a,i)=>{if(!n){var r=1/0;for(c=0;c<e.length;c++){for(var[n,a,i]=e[c],o=!0,l=0;l<n.length;l++)(!1&i||r>=i)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(o=!1,i<r&&(r=i));if(o){e.splice(c--,1);var u=a();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,a,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={826:0,431:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var a,i,[r,o,l]=n,u=0;if(r.some((t=>0!==e[t]))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(l)var c=l(s)}for(t&&t(n);u<r.length;u++)i=r[u],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},n=globalThis.webpackChunkqsm=globalThis.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=s.O(void 0,[431],(()=>s(550)));a=s.O(a)})();