!function(){"use strict";var e,t={758:function(e,t,n){var i=window.wp.blocks,s=window.wp.element,a=window.wp.i18n,r=window.wp.apiFetch,o=n.n(r),u=window.wp.blockEditor,l=window.wp.notices,c=window.wp.data,m=window.wp.editor,p=window.wp.components;const q=e=>null==e||""===e,_=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},d=(e=!1)=>{let t=new FormData;if(t.append("qsm_block_api_call","1"),!1!==e)for(let n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t},g=(e,t="")=>q(e)?t:e;(0,i.registerBlockType)("qsm/quiz",{edit:function(e){if("undefined"==typeof qsmBlockData)return null;const{className:t,attributes:n,setAttributes:i,isSelected:r,clientId:z}=e,{createNotice:h}=(0,c.useDispatch)(l.store),f=qsmBlockData.globalQuizsetting,{quizID:b,quizAttr:w=f}=n,[v,y]=(0,s.useState)(qsmBlockData.QSMQuizList),[k,E]=(0,s.useState)({error:!1,msg:""}),[D,I]=(0,s.useState)(!1),[B,x]=(0,s.useState)(!1),[S,C]=(0,s.useState)(!1),[O,P]=(0,s.useState)([]),N=qsmBlockData.quizOptions,A=(0,c.useSelect)((e=>{const{isAutosavingPost:t,isSavingPost:n}=e(m.store);return n()&&!t()}),[]),{getBlock:T}=(0,c.useSelect)(u.store);(0,s.useEffect)((()=>{let e=!0;return e&&!q(b)&&0<b&&M(b),()=>{e=!1}}),[]);const M=e=>{!q(e)&&0<e&&o()({path:"/quiz-survey-master/v1/quiz/structure",method:"POST",data:{quizID:e}}).then((t=>{if("success"==t.status){let n=t.result;if(i({quizID:parseInt(e),quizAttr:{...w,...n}}),!q(n.qpages)){let e=[];n.qpages.forEach((t=>{let n=[];q(t.question_arr)||t.question_arr.forEach((e=>{if(!q(e)){let t=[];!q(e.answers)&&0<e.answers.length&&e.answers.forEach(((e,n)=>{t.push(["qsm/quiz-answer-option",{optionID:n,content:e[0],points:e[1],isCorrect:e[2]}])})),n.push(["qsm/quiz-question",{questionID:e.question_id,type:e.question_type_new,answerEditor:e.settings.answerEditor,title:e.settings.question_title,description:e.question_name,required:e.settings.required,hint:e.hints,answers:e.answers,correctAnswerInfo:e.question_answer_info,category:e.category,multicategories:e.multicategories,commentBox:e.comments,matchAnswer:e.settings.matchAnswer,featureImageID:e.settings.featureImageID,featureImageSrc:e.settings.featureImageSrc,settings:e.settings},t])}})),e.push(["qsm/quiz-page",{pageID:t.id,pageKey:t.pagekey,hidePrevBtn:t.hide_prevbtn,quizID:t.quizID},n])})),P(e)}}else console.log("error "+t.msg)}))},Q=(e,t)=>{let n=w;n[t]=e,i({quizAttr:{...n}})};(0,s.useEffect)((()=>{if(A){let e=(()=>{let e=T(z);if(q(e))return!1;e=e.innerBlocks;let t={quiz_id:w.quiz_id,post_id:w.post_id,quiz:{},pages:[],qpages:[],questions:[]},n=0;return e.forEach((e=>{if("qsm/quiz-page"===e.name){let i=e.attributes.pageID,s=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-question"!==e.name)return!0;let i=[];!q(e.innerBlocks)&&0<e.innerBlocks.length&&e.innerBlocks.forEach((e=>{if("qsm/quiz-answer-option"!==e.name)return!0;let t=e.attributes;i.push([g(t?.content),g(t?.points),g(t?.isCorrect)])}));let a=e.attributes;s.push(a.questionID),t.questions.push({id:a.questionID,quizID:w.quiz_id,postID:w.post_id,answerEditor:g(a?.answerEditor,"text"),type:g(a?.type,"0"),name:_(g(a?.description)),question_title:g(a?.title),answerInfo:_(g(a?.correctAnswerInfo)),comments:g(a?.commentBox,"1"),hint:g(a?.hint),category:g(a?.category),multicategories:[],required:g(a?.required,1),answers:i,page:n})})),t.pages.push(s),t.qpages.push({id:i,quizID:w.quiz_id,pagekey:e.attributes.pageKey,hide_prevbtn:e.attributes.hidePrevBtn,questions:s}),n++}})),t.quiz={quiz_name:w.quiz_name,quiz_id:w.quiz_id,post_id:w.post_id},S&&["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((e=>{void 0!==w[e]&&null!==w[e]&&(t.quiz[e]=w[e])})),t})();x(!0),e=d({save_entire_quiz:"1",quizData:JSON.stringify(e),qsm_block_quiz_nonce:qsmBlockData.nonce,nonce:qsmBlockData.saveNonce}),o()({path:"/quiz-survey-master/v1/quiz/save_quiz",method:"POST",body:e}).then((e=>{})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))}}),[A]);const j=(0,u.useBlockProps)(),F=(0,u.useInnerBlocksProps)(j,{template:O,allowedBlocks:["qsm/quiz-page"]});return(0,s.createElement)(s.Fragment,null,(0,s.createElement)(u.InspectorControls,null,(0,s.createElement)(p.PanelBody,{title:(0,a.__)("Quiz settings","quiz-master-next"),initialOpen:!0},(0,s.createElement)(p.TextControl,{label:(0,a.__)("Quiz Name *","quiz-master-next"),help:(0,a.__)("Enter a name for this Quiz","quiz-master-next"),value:w?.quiz_name||"",onChange:e=>Q(e,"quiz_name")}))),q(b)||"0"==b?(0,s.createElement)(p.Placeholder,{icon:()=>(0,s.createElement)(p.Icon,{icon:"vault",size:"36"}),label:(0,a.__)("Quiz And Survey Master","quiz-master-next"),instructions:(0,a.__)("Easily and quickly add quizzes and surveys inside the block editor.","quiz-master-next")},(0,s.createElement)(s.Fragment,null,!q(v)&&0<v.length&&(0,s.createElement)("div",{className:"qsm-placeholder-select-create-quiz"},(0,s.createElement)(p.SelectControl,{label:(0,a.__)("","quiz-master-next"),value:b,options:v,onChange:e=>M(e),disabled:D,__nextHasNoMarginBottom:!0}),(0,s.createElement)("span",null,(0,a.__)("OR","quiz-master-next")),(0,s.createElement)(p.Button,{variant:"link",onClick:()=>I(!D)},(0,a.__)("Add New","quiz-master-next"))),(q(v)||D)&&(0,s.createElement)(p.__experimentalVStack,{spacing:"3",className:"qsm-placeholder-quiz-create-form"},(0,s.createElement)(p.TextControl,{label:(0,a.__)("Quiz Name *","quiz-master-next"),help:(0,a.__)("Enter a name for this Quiz","quiz-master-next"),value:w?.quiz_name||"",onChange:e=>Q(e,"quiz_name")}),(0,s.createElement)(p.Button,{variant:"link",onClick:()=>C(!S)},(0,a.__)("Advance options","quiz-master-next")),S&&(0,s.createElement)(s.Fragment,null,(0,s.createElement)(p.SelectControl,{label:N?.form_type?.label,value:w?.form_type,options:N?.form_type?.options,onChange:e=>Q(e,"form_type"),__nextHasNoMarginBottom:!0}),(0,s.createElement)(p.SelectControl,{label:N?.system?.label,value:w?.system,options:N?.system?.options,onChange:e=>Q(e,"system"),help:N?.system?.help,__nextHasNoMarginBottom:!0}),["timer_limit","pagination"].map((e=>(0,s.createElement)(p.TextControl,{key:"quiz-create-text-"+e,type:"number",label:N?.[e]?.label,help:N?.[e]?.help,value:q(w[e])?0:w[e],onChange:t=>Q(t,e)}))),["enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].map((e=>(0,s.createElement)(p.ToggleControl,{key:"quiz-create-toggle-"+e,label:N?.[e]?.label,help:N?.[e]?.help,checked:!q(w[e])&&"1"==w[e],onChange:()=>Q(q(w[e])||"1"!=w[e]?1:0,e)})))),(0,s.createElement)(p.Button,{variant:"primary",disabled:B||q(w.quiz_name),onClick:()=>(()=>{if(q(w.quiz_name))return void console.log("empty quiz_name");x(!0);let e=d({quiz_name:w.quiz_name,qsm_new_quiz_nonce:qsmBlockData.qsm_new_quiz_nonce});["form_type","system","timer_limit","pagination","enable_contact_form","enable_pagination_quiz","show_question_featured_image_in_result","progress_bar","require_log_in","disable_first_page","comment_section"].forEach((t=>void 0===w[t]||null===w[t]?"":e.append(t,w[t]))),o()({path:"/quiz-survey-master/v1/quiz/create_quiz",method:"POST",body:e}).then((e=>{if(console.log(e),x(!1),"success"==e.status){let t=d({id:null,quizID:e.quizID,answerEditor:"text",type:"0",name:"",question_title:"",answerInfo:"",comments:"1",hint:"",category:"",required:1,answers:[],page:0});o()({path:"/quiz-survey-master/v1/questions",method:"POST",body:t}).then((t=>{if(console.log("question response",t),"success"==t.status){let n=t.id,i=d({action:qsmBlockData.save_pages_action,quiz_id:e.quizID,nonce:qsmBlockData.saveNonce,post_id:e.quizPostID});i.append("pages[0][]",n),i.append("qpages[0][id]",1),i.append("qpages[0][quizID]",e.quizID),i.append("qpages[0][pagekey]",((e="",t=!1)=>`${e}${(1e3*Date.now()+1e3*Math.random()).toString(16).replace(/\./g,"").padEnd(8,"0")}${t?`.${Math.trunc(1e8*Math.random())}`:""}`)()),i.append("qpages[0][hide_prevbtn]",0),i.append("qpages[0][questions][]",n),o()({url:qsmBlockData.ajax_url,method:"POST",body:i}).then((t=>{console.log("pageResponse",t),"success"==t.status&&M(e.quizID)}))}})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))}h(e.status,e.msg,{isDismissible:!0,type:"snackbar"})})).catch((e=>{console.log("error",e),h("error",e.message,{isDismissible:!0,type:"snackbar"})}))})()},(0,a.__)("Create Quiz","quiz-master-next"))))):(0,s.createElement)("div",{...F}))},save:e=>null})}},n={};function i(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,e=[],i.O=function(t,n,s,a){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],s=e[c][1],a=e[c][2];for(var o=!0,u=0;u<n.length;u++)(!1&a||r>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[u])}))?n.splice(u--,1):(o=!1,a<r&&(r=a));if(o){e.splice(c--,1);var l=s();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,s,a]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={826:0,431:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,a,r=n[0],o=n[1],u=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(u)var c=u(i)}for(t&&t(n);l<r.length;l++)a=r[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(c)},n=self.webpackChunkqsm=self.webpackChunkqsm||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var s=i.O(void 0,[431],(function(){return i(758)}));s=i.O(s)}();