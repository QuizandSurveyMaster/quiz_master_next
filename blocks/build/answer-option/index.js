(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,n=window.wp.i18n,i=window.wp.htmlEntities,o=window.wp.escapeHtml,a=window.wp.blockEditor,l=window.wp.data,r=window.wp.url,c=window.wp.components,s=window.wp.blob,u=window.React,m=window.wp.primitives,d=(0,u.createElement)(m.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,u.createElement)(m.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"})),p=window.wp.notices,w=e=>null==e||""===e,g=e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value},E=e=>{let t=document.createElement("div");return t.innerHTML=g(e),t.innerText},h=function({url:e="",caption:i="",alt:o="",setURLCaption:r}){const u=["image"],[m,g]=(0,t.useState)(null),[E,h]=(0,t.useState)(),{imageDefaultSize:x,mediaUpload:f}=((0,t.useRef)(),(0,l.useSelect)((e=>{const{getSettings:t}=e(a.store),n=t();return{imageDefaultSize:n.imageDefaultSize,mediaUpload:n.mediaUpload}}),[])),{createErrorNotice:_}=(0,l.useDispatch)(p.store);function v(e){_(e,{type:"snackbar"}),r(void 0,void 0),h(void 0)}function q(e){if(!e||!e.url)return void r(void 0,void 0);if((0,s.isBlobURL)(e.url))return void h(e.url);h();let t=((e,t)=>{const n=Object.fromEntries(Object.entries(null!=e?e:{}).filter((([e])=>["alt","id","link","caption"].includes(e))));return n.url=e?.sizes?.[t]?.url||e?.media_details?.sizes?.[t]?.source_url||e.url,n})(e,x);g(t.id),r(t.url,t.caption)}function b(t){t!==e&&r(t,i)}let z=((e,t)=>!e&&(0,s.isBlobURL)(t))(m,e);(0,t.useEffect)((()=>{if(!z)return;const t=(0,s.getBlobByURL)(e);t&&f({filesList:[t],onFileChange:([e])=>{q(e)},allowedTypes:u,onError:e=>{z=!1,v(e)}})}),[]),(0,t.useEffect)((()=>{z?h(e):(0,s.revokeBlobURL)(E)}),[z,e]);const R=((e,t)=>t&&!e&&!(0,s.isBlobURL)(t))(m,e)?e:void 0,L=!!e&&(0,t.createElement)("img",{alt:(0,n.__)("Edit image"),title:(0,n.__)("Edit image"),className:"edit-image-preview",src:e});let B=(0,t.createElement)(t.Fragment,null,(0,t.createElement)("img",{src:E||e,alt:"",className:"qsm-answer-option-image",style:{width:"200",height:"auto"}}),E&&(0,t.createElement)(c.Spinner,null));return(0,t.createElement)("figure",null,w(e)?(0,t.createElement)(a.MediaPlaceholder,{icon:(0,t.createElement)(a.BlockIcon,{icon:d}),onSelect:q,onSelectURL:b,onError:v,accept:"image/*",allowedTypes:u,value:{id:m,src:R},mediaPreview:L,disableMediaButtons:E||e}):(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.BlockControls,{group:"other"},(0,t.createElement)(a.MediaReplaceFlow,{mediaId:m,mediaURL:e,allowedTypes:u,accept:"image/*",onSelect:q,onSelectURL:b,onError:v})),(0,t.createElement)("div",null,B)))},x=JSON.parse('{"u2":"qsm/quiz-answer-option"}');(0,e.registerBlockType)(x.u2,{icon:()=>(0,t.createElement)(c.Icon,{icon:()=>(0,t.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,t.createElement)("rect",{width:"24",height:"24",rx:"4.21657",fill:"#ADADAD"}),(0,t.createElement)("path",{d:"M8.96182 17.2773H7.33619L10.9889 7.12707H12.7583L16.411 17.2773H14.7853L11.9157 8.97077H11.8364L8.96182 17.2773ZM9.23441 13.3025H14.5078V14.5911H9.23441V13.3025Z",fill:"white"}))}),__experimentalLabel(e,{context:t}){const{content:n}=e,i=e?.metadata?.name;if("list-view"===t&&(i||n?.length>0))return i||n},merge:(e,t)=>({content:(e.content||"")+(t.content||"")}),edit:function(s){if("undefined"==typeof qsmBlockData)return null;const{className:u,attributes:m,setAttributes:d,isSelected:p,clientId:x,context:f,mergeBlocks:_,onReplace:v,onRemove:q}=s,b=(f["quiz-master-next/quizID"],f["quiz-master-next/pageID"],f["quiz-master-next/questionID"],f["quiz-master-next/questionType"]),z=f["quiz-master-next/answerType"],R=f["quiz-master-next/questionChanged"],L="qsm/quiz-answer-option",{optionID:B,content:k,caption:S,points:C,isCorrect:y}=m,{selectBlock:U}=(0,l.useDispatch)(a.store),{updateBlockAttributes:T}=(0,l.useDispatch)(a.store),D=(0,l.useSelect)((e=>{let t=e(a.store).getBlockParentsByBlockName(x,"qsm/quiz-question",!0);return w(t)?"":t[0]}),[x]);(0,t.useEffect)((()=>{let e=!0;return e&&p&&!w(D)&&!1===R&&T(D,{isChanged:!0}),()=>{e=!1}}),[k,S,C,y]),(0,t.useEffect)((()=>{let e=!0;return e&&(w(k)||!(0,r.isURL)(k)||-1===k.indexOf("https://")&&-1===k.indexOf("http://")||!["rich","text"].includes(z)||d({content:"",caption:""})),()=>{e=!1}}),[z]);const I=(0,a.useBlockProps)({className:p?" is-highlighted ":""}),A=["4","10"].includes(b)?"checkbox":"radio";return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(c.PanelBody,{title:(0,n.__)("Settings","quiz-master-next"),initialOpen:!0},"image"===z&&(0,t.createElement)(c.TextControl,{type:"text",label:(0,n.__)("Caption","quiz-master-next"),value:S,onChange:e=>d({caption:(0,o.escapeAttribute)(e)})}),(0,t.createElement)(c.TextControl,{type:"number",label:(0,n.__)("Points","quiz-master-next"),help:(0,n.__)("Answer points","quiz-master-next"),value:C,onChange:e=>d({points:e})}),["0","4","1","10","2"].includes(b)&&(0,t.createElement)(c.ToggleControl,{label:(0,n.__)("Correct","quiz-master-next"),checked:!w(y)&&"1"==y,onChange:()=>d({isCorrect:w(y)||"1"!=y?1:0})}))),(0,t.createElement)("div",{...I},(0,t.createElement)(c.__experimentalHStack,{className:"edit-post-document-actions__title",spacing:1,justify:"left"},(0,t.createElement)("input",{type:A,disabled:!0,readOnly:!0,tabIndex:"-1"}),!["rich","image"].includes(z)&&(0,t.createElement)(a.RichText,{tagName:"p",title:(0,n.__)("Answer options","quiz-master-next"),"aria-label":(0,n.__)("Question answer","quiz-master-next"),placeholder:(0,n.__)("Your Answer","quiz-master-next"),value:E((0,i.decodeEntities)(k)),onChange:e=>d({content:E((0,i.decodeEntities)(e))}),onSplit:(t,n)=>{let i;(n||t)&&(i={...m,content:t});const o=(0,e.createBlock)(L,i);return n&&(o.clientId=x),o},onMerge:_,onReplace:v,onRemove:q,allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-answer-option",identifier:"text"}),"rich"===z&&(0,t.createElement)(a.RichText,{tagName:"p",title:(0,n.__)("Answer options","quiz-master-next"),"aria-label":(0,n.__)("Question answer","quiz-master-next"),placeholder:(0,n.__)("Your Answer","quiz-master-next"),value:g((0,i.decodeEntities)(k)),onChange:e=>d({content:e}),onSplit:(t,n)=>{let i;(n||t)&&(i={...m,content:t});const o=(0,e.createBlock)(L,i);return n&&(o.clientId=x),o},onMerge:_,onReplace:v,onRemove:q,className:"qsm-question-answer-option",identifier:"text",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),"image"===z&&(0,t.createElement)(h,{url:(0,r.isURL)(k)?k:"",caption:S,setURLCaption:(e,t)=>d({content:(0,r.isURL)(e)?e:"",caption:t})}))))}})})();