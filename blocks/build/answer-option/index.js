(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,n=window.wp.i18n,i=window.wp.htmlEntities,a=window.wp.escapeHtml,o=window.wp.blockEditor,l=window.wp.data,r=window.wp.url,s=window.wp.components,c=window.wp.blob,u=window.React,m=window.wp.primitives,d=(0,u.createElement)(m.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,u.createElement)(m.Path,{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.5h14c.3 0 .5.2.5.5v8.4l-3-2.9c-.3-.3-.8-.3-1 0L11.9 14 9 12c-.3-.2-.6-.2-.8 0l-3.6 2.6V5c-.1-.3.1-.5.4-.5zm14 15H5c-.3 0-.5-.2-.5-.5v-2.4l4.1-3 3 1.9c.3.2.7.2.9-.1L16 12l3.5 3.4V19c0 .3-.2.5-.5.5z"})),p=window.wp.notices,w=e=>null==e||""===e,g=function({url:e="",caption:i="",alt:a="",setURLCaption:r}){const u=["image"],[m,g]=(0,t.useState)(null),[h,E]=(0,t.useState)(),{imageDefaultSize:x,mediaUpload:f}=((0,t.useRef)(),(0,l.useSelect)((e=>{const{getSettings:t}=e(o.store),n=t();return{imageDefaultSize:n.imageDefaultSize,mediaUpload:n.mediaUpload}}),[])),{createErrorNotice:_}=(0,l.useDispatch)(p.store);function q(e){_(e,{type:"snackbar"}),r(void 0,void 0),E(void 0)}function v(e){if(!e||!e.url)return void r(void 0,void 0);if((0,c.isBlobURL)(e.url))return void E(e.url);E();let t=((e,t)=>{const n=Object.fromEntries(Object.entries(null!=e?e:{}).filter((([e])=>["alt","id","link","caption"].includes(e))));return n.url=e?.sizes?.[t]?.url||e?.media_details?.sizes?.[t]?.source_url||e.url,n})(e,x);g(t.id),r(t.url,t.caption)}function b(t){t!==e&&r(t,i)}let z=((e,t)=>!e&&(0,c.isBlobURL)(t))(m,e);(0,t.useEffect)((()=>{if(!z)return;const t=(0,c.getBlobByURL)(e);t&&f({filesList:[t],onFileChange:([e])=>{v(e)},allowedTypes:u,onError:e=>{z=!1,q(e)}})}),[]),(0,t.useEffect)((()=>{z?E(e):(0,c.revokeBlobURL)(h)}),[z,e]);const R=((e,t)=>t&&!e&&!(0,c.isBlobURL)(t))(m,e)?e:void 0,B=!!e&&(0,t.createElement)("img",{alt:(0,n.__)("Edit image"),title:(0,n.__)("Edit image"),className:"edit-image-preview",src:e});let L=(0,t.createElement)(t.Fragment,null,(0,t.createElement)("img",{src:h||e,alt:"",className:"qsm-answer-option-image",style:{width:"200",height:"auto"}}),h&&(0,t.createElement)(s.Spinner,null));return(0,t.createElement)("figure",null,w(e)?(0,t.createElement)(o.MediaPlaceholder,{icon:(0,t.createElement)(o.BlockIcon,{icon:d}),onSelect:v,onSelectURL:b,onError:q,accept:"image/*",allowedTypes:u,value:{id:m,src:R},mediaPreview:B,disableMediaButtons:h||e}):(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.BlockControls,{group:"other"},(0,t.createElement)(o.MediaReplaceFlow,{mediaId:m,mediaURL:e,allowedTypes:u,accept:"image/*",onSelect:v,onSelectURL:b,onError:q})),(0,t.createElement)("div",null,L)))},h=JSON.parse('{"u2":"qsm/quiz-answer-option"}');(0,e.registerBlockType)(h.u2,{icon:()=>(0,t.createElement)(s.Icon,{icon:()=>(0,t.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,t.createElement)("rect",{width:"24",height:"24",rx:"4.21657",fill:"#ADADAD"}),(0,t.createElement)("path",{d:"M8.96182 17.2773H7.33619L10.9889 7.12707H12.7583L16.411 17.2773H14.7853L11.9157 8.97077H11.8364L8.96182 17.2773ZM9.23441 13.3025H14.5078V14.5911H9.23441V13.3025Z",fill:"white"}))}),__experimentalLabel(e,{context:t}){const{content:n}=e,i=e?.metadata?.name;if("list-view"===t&&(i||n?.length>0))return i||n},merge:(e,t)=>({content:(e.content||"")+(t.content||"")}),edit:function(c){if("undefined"==typeof qsmBlockData)return null;const{className:u,attributes:m,setAttributes:d,isSelected:p,clientId:h,context:E,mergeBlocks:x,onReplace:f,onRemove:_}=c,q=(E["quiz-master-next/quizID"],E["quiz-master-next/pageID"],E["quiz-master-next/questionID"],E["quiz-master-next/questionType"]),v=E["quiz-master-next/answerType"],b=E["quiz-master-next/questionChanged"],z="qsm/quiz-answer-option",{optionID:R,content:B,caption:L,points:k,isCorrect:S}=m,{selectBlock:C}=(0,l.useDispatch)(o.store),{updateBlockAttributes:y}=(0,l.useDispatch)(o.store),U=(0,l.useSelect)((e=>{let t=e(o.store).getBlockParentsByBlockName(h,"qsm/quiz-question",!0);return w(t)?"":t[0]}),[h]);(0,t.useEffect)((()=>{let e=!0;return e&&p&&!w(U)&&!1===b&&y(U,{isChanged:!0}),()=>{e=!1}}),[B,L,k,S]),(0,t.useEffect)((()=>{let e=!0;return e&&(w(B)||!(0,r.isURL)(B)||-1===B.indexOf("https://")&&-1===B.indexOf("http://")||!["rich","text"].includes(v)||d({content:"",caption:""})),()=>{e=!1}}),[v]);const A=(0,o.useBlockProps)({className:p?" is-highlighted ":""}),D=["4","10"].includes(q)?"checkbox":"radio";return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(s.PanelBody,{title:(0,n.__)("Settings","quiz-master-next"),initialOpen:!0},"image"===v&&(0,t.createElement)(s.TextControl,{type:"text",label:(0,n.__)("Caption","quiz-master-next"),value:L,onChange:e=>d({caption:(0,a.escapeAttribute)(e)})}),(0,t.createElement)(s.TextControl,{type:"number",label:(0,n.__)("Points","quiz-master-next"),help:(0,n.__)("Answer points","quiz-master-next"),value:k,onChange:e=>d({points:e})}),["0","4","1","10","2"].includes(q)&&(0,t.createElement)(s.ToggleControl,{label:(0,n.__)("Correct","quiz-master-next"),checked:!w(S)&&"1"==S,onChange:()=>d({isCorrect:w(S)||"1"!=S?1:0})}))),(0,t.createElement)("div",{...A},(0,t.createElement)(s.__experimentalHStack,{className:"edit-post-document-actions__title",spacing:1,justify:"left"},(0,t.createElement)("input",{type:D,disabled:!0,readOnly:!0,tabIndex:"-1"}),!["rich","image"].includes(v)&&(0,t.createElement)(o.RichText,{tagName:"p",title:(0,n.__)("Answer options","quiz-master-next"),"aria-label":(0,n.__)("Question answer","quiz-master-next"),placeholder:(0,n.__)("Your Answer","quiz-master-next"),value:(0,a.escapeAttribute)(B),onChange:e=>d({content:(0,a.escapeAttribute)(e)}),onSplit:(t,n)=>{let i;(n||t)&&(i={...m,content:t});const a=(0,e.createBlock)(z,i);return n&&(a.clientId=h),a},onMerge:x,onReplace:f,onRemove:_,allowedFormats:[],withoutInteractiveFormatting:!0,className:"qsm-question-answer-option",identifier:"text"}),"rich"===v&&(0,t.createElement)(o.RichText,{tagName:"p",title:(0,n.__)("Answer options","quiz-master-next"),"aria-label":(0,n.__)("Question answer","quiz-master-next"),placeholder:(0,n.__)("Your Answer","quiz-master-next"),value:(I=(0,i.decodeEntities)(B),T=document.createElement("textarea"),T.innerHTML=I,T.value),onChange:e=>d({content:e}),onSplit:(t,n)=>{let i;(n||t)&&(i={...m,content:t});const a=(0,e.createBlock)(z,i);return n&&(a.clientId=h),a},onMerge:x,onReplace:f,onRemove:_,className:"qsm-question-answer-option",identifier:"text",__unstableEmbedURLOnPaste:!0,__unstableAllowPrefixTransformations:!0}),"image"===v&&(0,t.createElement)(g,{url:(0,r.isURL)(B)?B:"",caption:L,setURLCaption:(e,t)=>d({content:(0,r.isURL)(e)?e:"",caption:t})}))));var I,T}})})();